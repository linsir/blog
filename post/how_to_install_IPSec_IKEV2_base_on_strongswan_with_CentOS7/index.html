<!doctype html>
<html data-n-head-ssr data-n-head="">
  <head data-n-head="">
    <title>CentOS7下Strongswan架设IPSec-IKEv1, IKEv2, L2TP VPN,适用于 IOS9,OSX, Windows, Linux | Linsir's Blog</title><meta data-n-head="ssr" charset="utf-8"><meta data-n-head="ssr" name="viewport" content="width=device-width,initial-scale=1"><meta data-n-head="ssr" data-hid="description" name="description" content="CentOS7下Strongswan架设IPSec-IKEv1, IKEv2, L2TP VPN,适用于 IOS9,OSX, Windows, Linux"><link data-n-head="ssr" rel="icon" type="image/x-icon" href="/favicon.ico"><script data-n-head="ssr" src="https://hm.baidu.com/hm.js?bdce3a2c9b8a2b43fd2c2389ea1bb949"></script><link rel="preload" href="https://static.hdagb.cn/b99333d07f58a2457f11.js" as="script"><link rel="preload" href="https://static.hdagb.cn/e0fea6d2c5ac316d33a0.js" as="script"><link rel="preload" href="https://static.hdagb.cn/1d9642f96a5761cf821e.js" as="script"><link rel="preload" href="https://static.hdagb.cn/ec75a6822724ae0b86fc.js" as="script"><style data-vue-ssr-id="670953a9:0 c1e1ffa6:0 4a0217f0:0 673dfe53:0 6be79c23:0 57ef8ebe:0 77ea86f4:0 03c7a666:0 efc8252e:0">body{font-family:Quantico,Microsoft YaHei UI,Microsoft YaHei,WenQuanYi Micro Hei,sans-serif;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;margin:0}a,body{color:#34495e}a{text-decoration:none}a:active,a:hover{outline:0;color:#42b983}img{border:none}h1{font-size:27px}h2{font-size:21px}h3{font-size:16px}h4{font-size:14px}h5{font-size:12px}h6{font-size:11px}h1,h2,h3,h4,strong{font-weight:400;color:#2c3e50}h1{padding-bottom:.3em;line-height:1.225;border-bottom:1px solid #eee}em{color:#7f8c8d}p{word-spacing:.05em}ul{line-height:1.5em}li{list-style:none}hr{height:0;margin:15px 0;overflow:hidden;background:0 0;border:0;border-bottom:1px solid #ddd}hr:after,hr:before{display:table;content:""}hr:after{clear:both}a.button{padding:.75em 2em;border-radius:2em;display:inline-block;color:#fff;background-color:#4fc08d;transition:all .15s ease;box-sizing:border-box;border:1px solid #4fc08d}a.button.white{background-color:#fff;color:#42b983}a.small-button{display:inline-block;font-weight:700;color:#fff;background-color:#4fc08d;transition:all .15s ease;padding:4px 8px 5px;border-radius:4px;width:140px;margin:0 5px}a.small-button:hover{background-color:#5dc596;transform:scale(1.03)}code{font-family:Roboto Mono,Monaco,courier,monospace;color:#c7254e;padding:.2em 2px;margin:0;font-size:85%;background-color:rgba(0,0,0,.04);border-radius:3px}p.tip{padding:12px 24px 12px 30px;margin:2em 0;border-left:4px solid #f66;background-color:rgba(255,240,0,.28);position:relative;border-bottom-right-radius:2px;border-top-right-radius:2px}p.tip:before{position:absolute;top:14px;left:-12px;background-color:#f66;color:#fff;content:"!";width:20px;height:20px;border-radius:100%;text-align:center;line-height:20px;font-weight:700;font-family:Dosis,Source Sans Pro,Helvetica Neue,Arial,sans-serif;font-size:14px}.social-icons{text-align:center;float:none;font-size:1.75rem;padding:.5em 0 0;width:100%}.social-icons a.fa{cursor:pointer;opacity:.8;padding:.2em}.social-icons a.fa:hover{opacity:1}.clear:after,.clear:before{content:"";display:table}.clear:after{clear:both}.clear{zoom:1}#nav .nav-link{cursor:pointer}#nav .nav-dropdown-container .nav-link:hover{border-bottom:none}#nav .nav-dropdown-container:hover .nav-dropdown{display:block}#nav .nav-dropdown-container li{white-space:nowrap}#nav .nav-dropdown{display:none;position:absolute;top:100%;left:-30%;background-color:#fff;padding:10px 0;border:1px solid;border-color:#ddd #ddd #ccc;text-align:left;border-radius:4px}#nav .nav-dropdown li{line-height:1.8em;margin:0;display:block;white-space:nowrap}#nav .nav-dropdown a{color:#7f8c8d;font-size:.9em;display:block;padding:0 30px 0 20px}#nav .nav-dropdown a:hover{color:#42b983}#nav .arrow{display:inline-block;vertical-align:middle;margin-top:-1px;margin-left:6px;margin-right:-14px;width:0;height:0;border-left:4px solid transparent;border-right:4px solid transparent;border-top:5px solid #ccc}#main{z-index:1;padding:0 60px 30px;overflow-x:hidden}#header,#main{position:relative}#header{background-color:#fff;box-shadow:0 0 4px rgba(0,0,0,.25);padding:15px 60px;z-index:2}#nav{list-style-type:none;margin:0;padding:0;position:absolute;right:60px;top:15px;height:40px;line-height:40px}#nav .break{display:none}#nav li{display:inline-block;position:relative;margin:0 .6em}.nav-link{padding-bottom:3px}.nav-link.current,.nav-link:hover{border-bottom:3px solid #42b983}.jumbotron{text-align:center;color:#7f8c8d;font-size:18px}#search-query{height:30px;line-height:30px;box-sizing:border-box;padding:0 15px 0 30px;border:1px solid #e3e3e3;outline:0;border-radius:15px;margin-right:10px;transition:border-color .2s ease;background:#fff url(https://static.hdagb.cn/img/86e1486.png) 8px 5px no-repeat;background-size:20px}#search-query:focus{border-color:#42b983}#logo{display:inline-block;font-size:1.5em;line-height:40px;color:#2c3e50;font-family:Dosis,Source Sans Pro,Helvetica Neue,Arial,sans-serif;font-weight:500}#logo img{vertical-align:middle;margin-right:6px;width:40px;height:40px}#mobile-bar{position:fixed;top:0;left:0;width:100%;height:40px;background-color:#fff;z-index:9;display:none;box-shadow:0 0 4px rgba(0,0,0,.25)}#mobile-bar .menu-button{position:absolute;width:24px;height:24px;top:8px;left:12px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAQAAAD9CzEMAAAAIGNIUk0AAHomAACAhAAA+gAAAIDoAAB1MAAA6mAAADqYAAAXcJy6UTwAAAACYktHRAD/h4/MvwAAAAlwSFlzAAALEwAACxMBAJqcGAAAADlJREFUWMPt08ERACAIBDEomvqxBh18EQogn9us+HsJAAAAt0BPfQU8A2YKULKSdQAQmpIBAMBm4AAtdCIhmRB8RAAAAABJRU5ErkJggg==) 50% no-repeat;background-size:24px}#mobile-bar .logo{position:absolute;width:30px;height:30px;background:url(https://static.hdagb.cn/img/34bbbdb.png) 50% no-repeat;top:5px;left:40%;margin-left:-15px;background-size:30px}#mobile-bar .title{position:absolute;width:100px;height:30px;top:10px;left:45%;background-size:30px}.sidebar{position:absolute;z-index:10;top:0;left:55px;bottom:0;padding-top:120px;margin-right:20px;overflow-x:hidden;overflow-y:auto;-webkit-overflow-scrolling:touch;-ms-overflow-style:none}.sidebar h2{margin-top:.2em}.sidebar ul{list-style-type:none;margin:0;line-height:1.8em;padding-left:1em}.sidebar .version-select{vertical-align:middle;margin-left:5px}.sidebar .menu-root{padding-left:0}.sidebar .menu-sub{font-size:.85em}.sidebar .sidebar-link{color:#7f8c8d}.sidebar .sidebar-link.current{font-weight:600;color:#42b983}.sidebar .sidebar-link.new:after{content:"NEW";display:inline-block;font-size:10px;font-weight:600;color:#fff;background-color:#42b983;line-height:14px;padding:0 4px;border-radius:3px;margin-left:5px;vertical-align:middle;position:relative;top:-1px}.sidebar .sidebar-link:hover{border-bottom:2px solid #42b983}.sidebar .section-link.active{font-weight:700;color:#42b983}.sidebar .main-menu{margin-bottom:20px;display:none;padding-left:0}#main.fix-sidebar .sidebar{position:fixed;padding-top:100px}@media screen and (max-width:860px){body{-webkit-text-size-adjust:none;font-size:14px}#header,#logo{display:none}.nav-link{padding-bottom:1px}.nav-link.current,.nav-link:hover{border-bottom:2px solid #42b983}#search-query{width:300px;margin-bottom:10px}#mobile-bar{display:block}#main{padding:2em 1.4em 0}.highlight pre{padding:1.2em 1em}.jumbotron{color:#7f8c8d;font-size:18px}.sidebar{position:fixed;background-color:#f9f9f9;height:100%;top:40px;left:0;padding:60px 30px 20px;box-shadow:0 0 10px rgba(0,0,0,.2);box-sizing:border-box;transition:all .4s cubic-bezier(.4,0,0,1);transform:translate(-425px)}.sidebar .main-menu{display:block}.sidebar.open{transform:translate(0)}.content.with-sidebar{margin-left:0}.content ul{padding-left:2px}.content li{padding-left:1px}.footer{margin-left:0;text-align:center}}@media screen and (max-width:560px){#downloads{text-align:center;margin-bottom:25px}#downloads .info{margin-top:5px;margin-left:0}iframe{margin:0!important}}.content{padding-top:20px}.content a.button{font-size:.9em;color:#fff;margin:.2em 0;text-align:center;padding:12px 24px;display:inline-block;vertical-align:middle}.content img{display:block}.content span.light{color:#7f8c8d}.content span.info{font-size:.85em;color:#7f8c8d;display:inline-block;vertical-align:middle;width:280px;margin-left:20px}.content h1{margin:0 0 1em}.content h2{margin:2em 0 .8em;padding-bottom:.7em;border-bottom:1px solid #ddd}.content h3{margin:3em 0 1.2em;position:relative}.content h3:before{content:"#";color:#42b983;position:absolute;left:-.7em;top:-2px;font-size:1.2em;font-weight:700}.content figure,.content ol,.content p,.content ul{margin:1.2em 0}.content ol,.content p,.content ul{line-height:1.6em}.content blockquote{margin:2em 0;padding-left:20px;border-left:4px solid #42b983}.content blockquote p{font-weight:600;margin-left:0}.content iframe{margin:1em 0}.content strong{font-weight:700}.content input{color:inherit;font:inherit;margin:0}.content html input[disabled]{cursor:default}.content input{line-height:normal}.content input[type=checkbox]{box-sizing:border-box;padding:0}.content table{border-collapse:collapse;border-spacing:0}.content td,.content th{padding:0}.content *{box-sizing:border-box}.content input{font:13px/1.4 Helvetica,arial,freesans,clean,sans-serif,Segoe UI Emoji,Segoe UI Symbol}.content a{color:#42b983;font-weight:600}.content a:active,.content a:hover{outline:0;color:#34495e}.content hr{height:0;margin:15px 0;overflow:hidden;background:0 0;border:0;border-bottom:1px solid #ddd}.content hr:after,.content hr:before{display:table;content:""}.content hr:after{clear:both}.content blockquote{margin:0}.content ol,.content ul{padding:0;margin-top:0;margin-bottom:0}.content ol ol,.content ul ol{list-style-type:lower-roman}.content ol ol ol,.content ol ul ol,.content ul ol ol,.content ul ul ol{list-style-type:lower-alpha}.content dd{margin-left:0}.content .octicon{font:normal normal 16px octicons-anchor;line-height:1;display:inline-block;text-decoration:none;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.content .octicon-link:before{content:"\f05c"}.content>:first-child{margin-top:0!important}.content>:last-child{margin-bottom:0!important}.content .anchor{position:absolute;top:0;left:0;display:block;padding-right:6px;padding-left:30px;margin-left:-30px}.content .anchor:focus{outline:0}.content h3{margin-left:20px}.content h1,.content h2,.content h3,.content h4,.content h5,.content h6{position:relative;margin-top:1em;margin-bottom:16px;font-weight:600;line-height:1.4}.content h1 .octicon-link,.content h2 .octicon-link,.content h3 .octicon-link,.content h4 .octicon-link,.content h5 .octicon-link,.content h6 .octicon-link{display:none;color:#000;vertical-align:middle}.content h1:hover .anchor,.content h2:hover .anchor,.content h3:hover .anchor,.content h4:hover .anchor,.content h5:hover .anchor,.content h6:hover .anchor{padding-left:8px;margin-left:-30px;text-decoration:none}.content h1:hover .anchor .octicon-link,.content h2:hover .anchor .octicon-link,.content h3:hover .anchor .octicon-link,.content h4:hover .anchor .octicon-link,.content h5:hover .anchor .octicon-link,.content h6:hover .anchor .octicon-link{display:inline-block}.content h1{padding-bottom:.3em;font-size:1.75em;line-height:1.2;border-bottom:1px solid #eee}.content h1 .anchor{line-height:1}.content h2{padding-bottom:.3em;font-size:1.5em;line-height:1.225;border-bottom:1px solid #eee}.content h2 .anchor{line-height:1}.content h3{font-size:1.25em;line-height:1.43}.content h3 .anchor{line-height:1.2}.content h4{font-size:1.1em}.content h4 .anchor{line-height:1.2}.content h5{font-size:1em}.content h5 .anchor{line-height:1.1}.content h6{font-size:1em;color:#777}.content h6 .anchor{line-height:1.1}.content blockquote,.content dl,.content ol,.content p,.content pre,.content table,.content ul{margin-top:0;margin-bottom:16px}.content ol,.content ul{padding-left:1.5em}.content ol ol,.content ol ul,.content ul ol,.content ul ul{margin-top:0;margin-bottom:0}.content li>p{margin-top:16px}.content dl{padding:0}.content dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:700}.content dl dd{padding:0 16px;margin-bottom:16px}.content blockquote{padding:0 15px;color:#777;border-left:4px solid #ddd}.content blockquote>:first-child{margin-top:0}.content blockquote>:last-child{margin-bottom:0}.content table{display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}.content table th{font-weight:700}.content table td,.content table th{padding:6px 13px;border:1px solid #ddd}.content table tr{background-color:#fff;border-top:1px solid #ccc}.content table tr:nth-child(2n){background-color:#f8f8f8}.content img{max-width:100%;box-sizing:border-box}.content code{font-family:Roboto Mono,Monaco,courier,monospace;font-size:15px;color:#c7254e;padding:.2em 0;margin:0;background-color:rgba(0,0,0,.04);border-radius:3px}.content code:after,.content code:before{letter-spacing:-.2em;content:"\00a0"}.content pre>code{padding:0;margin:0;word-break:normal;white-space:pre;background:0 0;border:0}.content .highlight{margin-bottom:16px}.content .highlight pre,.content pre{padding:16px;overflow:auto;line-height:1.45;background-color:#464343;border-radius:3px}.content .highlight pre{margin-bottom:0;word-break:normal}.content pre{word-wrap:normal}.content pre code{display:inline;max-width:none;font-family:Roboto Mono,Monaco,courier,monospace;font-size:15px;padding:0;margin:0;overflow:visible;overflow:initial;line-height:inherit;word-wrap:normal;background-color:transparent;border:0;color:#66d9ef}.content pre code:after,.content pre code:before{content:normal}.content kbd{display:inline-block;padding:3px 5px;font-size:11px;line-height:10px;color:#555;vertical-align:middle;background-color:#fcfcfc;border:1px solid;border-color:#ccc #ccc #bbb;border-radius:3px;box-shadow:inset 0 -1px 0 #bbb}.content .task-list-item{list-style-type:none}.content .task-list-item+.task-list-item{margin-top:3px}.content .task-list-item input{float:left;margin:.3em 0 .25em -1.6em;vertical-align:middle}.content :checked+.radio-label{z-index:1;position:relative;border-color:#4183c4}/*!
 *  Font Awesome 4.7.0 by @davegandy - http://fontawesome.io - @fontawesome
 *  License - http://fontawesome.io/license (Font: SIL OFL 1.1, CSS: MIT License)
 */@font-face{font-family:FontAwesome;src:url(https://static.hdagb.cn/fonts/674f50d.eot);src:url(https://static.hdagb.cn/fonts/674f50d.eot?#iefix&v=4.7.0) format("embedded-opentype"),url(https://static.hdagb.cn/fonts/af7ae50.woff2) format("woff2"),url(https://static.hdagb.cn/fonts/fee66e7.woff) format("woff"),url(https://static.hdagb.cn/fonts/b06871f.ttf) format("truetype"),url(https://static.hdagb.cn/img/912ec66.svg#fontawesomeregular) format("svg");font-weight:400;font-style:normal}.fa{display:inline-block;font:normal normal normal 14px/1 FontAwesome;font-size:inherit;text-rendering:auto;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.fa-lg{font-size:1.33333333em;line-height:.75em;vertical-align:-15%}.fa-2x{font-size:2em}.fa-3x{font-size:3em}.fa-4x{font-size:4em}.fa-5x{font-size:5em}.fa-fw{width:1.28571429em;text-align:center}.fa-ul{padding-left:0;margin-left:2.14285714em;list-style-type:none}.fa-ul>li{position:relative}.fa-li{position:absolute;left:-2.14285714em;width:2.14285714em;top:.14285714em;text-align:center}.fa-li.fa-lg{left:-1.85714286em}.fa-border{padding:.2em .25em .15em;border:.08em solid #eee;border-radius:.1em}.fa-pull-left{float:left}.fa-pull-right{float:right}.fa.fa-pull-left{margin-right:.3em}.fa.fa-pull-right{margin-left:.3em}.pull-right{float:right}.pull-left{float:left}.fa.pull-left{margin-right:.3em}.fa.pull-right{margin-left:.3em}.fa-spin{-webkit-animation:fa-spin 2s linear infinite;animation:fa-spin 2s linear infinite}.fa-pulse{-webkit-animation:fa-spin 1s steps(8) infinite;animation:fa-spin 1s steps(8) infinite}@-webkit-keyframes fa-spin{0%{transform:rotate(0)}to{transform:rotate(359deg)}}@keyframes fa-spin{0%{transform:rotate(0)}to{transform:rotate(359deg)}}.fa-rotate-90{transform:rotate(90deg)}.fa-rotate-180{transform:rotate(180deg)}.fa-rotate-270{transform:rotate(270deg)}.fa-flip-horizontal{transform:scaleX(-1)}.fa-flip-vertical{transform:scaleY(-1)}:root .fa-flip-horizontal,:root .fa-flip-vertical,:root .fa-rotate-180,:root .fa-rotate-270,:root .fa-rotate-90{-webkit-filter:none;filter:none}.fa-stack{position:relative;display:inline-block;width:2em;height:2em;line-height:2em;vertical-align:middle}.fa-stack-1x,.fa-stack-2x{position:absolute;left:0;width:100%;text-align:center}.fa-stack-1x{line-height:inherit}.fa-stack-2x{font-size:2em}.fa-inverse{color:#fff}.fa-glass:before{content:"\f000"}.fa-music:before{content:"\f001"}.fa-search:before{content:"\f002"}.fa-envelope-o:before{content:"\f003"}.fa-heart:before{content:"\f004"}.fa-star:before{content:"\f005"}.fa-star-o:before{content:"\f006"}.fa-user:before{content:"\f007"}.fa-film:before{content:"\f008"}.fa-th-large:before{content:"\f009"}.fa-th:before{content:"\f00a"}.fa-th-list:before{content:"\f00b"}.fa-check:before{content:"\f00c"}.fa-close:before,.fa-remove:before,.fa-times:before{content:"\f00d"}.fa-search-plus:before{content:"\f00e"}.fa-search-minus:before{content:"\f010"}.fa-power-off:before{content:"\f011"}.fa-signal:before{content:"\f012"}.fa-cog:before,.fa-gear:before{content:"\f013"}.fa-trash-o:before{content:"\f014"}.fa-home:before{content:"\f015"}.fa-file-o:before{content:"\f016"}.fa-clock-o:before{content:"\f017"}.fa-road:before{content:"\f018"}.fa-download:before{content:"\f019"}.fa-arrow-circle-o-down:before{content:"\f01a"}.fa-arrow-circle-o-up:before{content:"\f01b"}.fa-inbox:before{content:"\f01c"}.fa-play-circle-o:before{content:"\f01d"}.fa-repeat:before,.fa-rotate-right:before{content:"\f01e"}.fa-refresh:before{content:"\f021"}.fa-list-alt:before{content:"\f022"}.fa-lock:before{content:"\f023"}.fa-flag:before{content:"\f024"}.fa-headphones:before{content:"\f025"}.fa-volume-off:before{content:"\f026"}.fa-volume-down:before{content:"\f027"}.fa-volume-up:before{content:"\f028"}.fa-qrcode:before{content:"\f029"}.fa-barcode:before{content:"\f02a"}.fa-tag:before{content:"\f02b"}.fa-tags:before{content:"\f02c"}.fa-book:before{content:"\f02d"}.fa-bookmark:before{content:"\f02e"}.fa-print:before{content:"\f02f"}.fa-camera:before{content:"\f030"}.fa-font:before{content:"\f031"}.fa-bold:before{content:"\f032"}.fa-italic:before{content:"\f033"}.fa-text-height:before{content:"\f034"}.fa-text-width:before{content:"\f035"}.fa-align-left:before{content:"\f036"}.fa-align-center:before{content:"\f037"}.fa-align-right:before{content:"\f038"}.fa-align-justify:before{content:"\f039"}.fa-list:before{content:"\f03a"}.fa-dedent:before,.fa-outdent:before{content:"\f03b"}.fa-indent:before{content:"\f03c"}.fa-video-camera:before{content:"\f03d"}.fa-image:before,.fa-photo:before,.fa-picture-o:before{content:"\f03e"}.fa-pencil:before{content:"\f040"}.fa-map-marker:before{content:"\f041"}.fa-adjust:before{content:"\f042"}.fa-tint:before{content:"\f043"}.fa-edit:before,.fa-pencil-square-o:before{content:"\f044"}.fa-share-square-o:before{content:"\f045"}.fa-check-square-o:before{content:"\f046"}.fa-arrows:before{content:"\f047"}.fa-step-backward:before{content:"\f048"}.fa-fast-backward:before{content:"\f049"}.fa-backward:before{content:"\f04a"}.fa-play:before{content:"\f04b"}.fa-pause:before{content:"\f04c"}.fa-stop:before{content:"\f04d"}.fa-forward:before{content:"\f04e"}.fa-fast-forward:before{content:"\f050"}.fa-step-forward:before{content:"\f051"}.fa-eject:before{content:"\f052"}.fa-chevron-left:before{content:"\f053"}.fa-chevron-right:before{content:"\f054"}.fa-plus-circle:before{content:"\f055"}.fa-minus-circle:before{content:"\f056"}.fa-times-circle:before{content:"\f057"}.fa-check-circle:before{content:"\f058"}.fa-question-circle:before{content:"\f059"}.fa-info-circle:before{content:"\f05a"}.fa-crosshairs:before{content:"\f05b"}.fa-times-circle-o:before{content:"\f05c"}.fa-check-circle-o:before{content:"\f05d"}.fa-ban:before{content:"\f05e"}.fa-arrow-left:before{content:"\f060"}.fa-arrow-right:before{content:"\f061"}.fa-arrow-up:before{content:"\f062"}.fa-arrow-down:before{content:"\f063"}.fa-mail-forward:before,.fa-share:before{content:"\f064"}.fa-expand:before{content:"\f065"}.fa-compress:before{content:"\f066"}.fa-plus:before{content:"\f067"}.fa-minus:before{content:"\f068"}.fa-asterisk:before{content:"\f069"}.fa-exclamation-circle:before{content:"\f06a"}.fa-gift:before{content:"\f06b"}.fa-leaf:before{content:"\f06c"}.fa-fire:before{content:"\f06d"}.fa-eye:before{content:"\f06e"}.fa-eye-slash:before{content:"\f070"}.fa-exclamation-triangle:before,.fa-warning:before{content:"\f071"}.fa-plane:before{content:"\f072"}.fa-calendar:before{content:"\f073"}.fa-random:before{content:"\f074"}.fa-comment:before{content:"\f075"}.fa-magnet:before{content:"\f076"}.fa-chevron-up:before{content:"\f077"}.fa-chevron-down:before{content:"\f078"}.fa-retweet:before{content:"\f079"}.fa-shopping-cart:before{content:"\f07a"}.fa-folder:before{content:"\f07b"}.fa-folder-open:before{content:"\f07c"}.fa-arrows-v:before{content:"\f07d"}.fa-arrows-h:before{content:"\f07e"}.fa-bar-chart-o:before,.fa-bar-chart:before{content:"\f080"}.fa-twitter-square:before{content:"\f081"}.fa-facebook-square:before{content:"\f082"}.fa-camera-retro:before{content:"\f083"}.fa-key:before{content:"\f084"}.fa-cogs:before,.fa-gears:before{content:"\f085"}.fa-comments:before{content:"\f086"}.fa-thumbs-o-up:before{content:"\f087"}.fa-thumbs-o-down:before{content:"\f088"}.fa-star-half:before{content:"\f089"}.fa-heart-o:before{content:"\f08a"}.fa-sign-out:before{content:"\f08b"}.fa-linkedin-square:before{content:"\f08c"}.fa-thumb-tack:before{content:"\f08d"}.fa-external-link:before{content:"\f08e"}.fa-sign-in:before{content:"\f090"}.fa-trophy:before{content:"\f091"}.fa-github-square:before{content:"\f092"}.fa-upload:before{content:"\f093"}.fa-lemon-o:before{content:"\f094"}.fa-phone:before{content:"\f095"}.fa-square-o:before{content:"\f096"}.fa-bookmark-o:before{content:"\f097"}.fa-phone-square:before{content:"\f098"}.fa-twitter:before{content:"\f099"}.fa-facebook-f:before,.fa-facebook:before{content:"\f09a"}.fa-github:before{content:"\f09b"}.fa-unlock:before{content:"\f09c"}.fa-credit-card:before{content:"\f09d"}.fa-feed:before,.fa-rss:before{content:"\f09e"}.fa-hdd-o:before{content:"\f0a0"}.fa-bullhorn:before{content:"\f0a1"}.fa-bell:before{content:"\f0f3"}.fa-certificate:before{content:"\f0a3"}.fa-hand-o-right:before{content:"\f0a4"}.fa-hand-o-left:before{content:"\f0a5"}.fa-hand-o-up:before{content:"\f0a6"}.fa-hand-o-down:before{content:"\f0a7"}.fa-arrow-circle-left:before{content:"\f0a8"}.fa-arrow-circle-right:before{content:"\f0a9"}.fa-arrow-circle-up:before{content:"\f0aa"}.fa-arrow-circle-down:before{content:"\f0ab"}.fa-globe:before{content:"\f0ac"}.fa-wrench:before{content:"\f0ad"}.fa-tasks:before{content:"\f0ae"}.fa-filter:before{content:"\f0b0"}.fa-briefcase:before{content:"\f0b1"}.fa-arrows-alt:before{content:"\f0b2"}.fa-group:before,.fa-users:before{content:"\f0c0"}.fa-chain:before,.fa-link:before{content:"\f0c1"}.fa-cloud:before{content:"\f0c2"}.fa-flask:before{content:"\f0c3"}.fa-cut:before,.fa-scissors:before{content:"\f0c4"}.fa-copy:before,.fa-files-o:before{content:"\f0c5"}.fa-paperclip:before{content:"\f0c6"}.fa-floppy-o:before,.fa-save:before{content:"\f0c7"}.fa-square:before{content:"\f0c8"}.fa-bars:before,.fa-navicon:before,.fa-reorder:before{content:"\f0c9"}.fa-list-ul:before{content:"\f0ca"}.fa-list-ol:before{content:"\f0cb"}.fa-strikethrough:before{content:"\f0cc"}.fa-underline:before{content:"\f0cd"}.fa-table:before{content:"\f0ce"}.fa-magic:before{content:"\f0d0"}.fa-truck:before{content:"\f0d1"}.fa-pinterest:before{content:"\f0d2"}.fa-pinterest-square:before{content:"\f0d3"}.fa-google-plus-square:before{content:"\f0d4"}.fa-google-plus:before{content:"\f0d5"}.fa-money:before{content:"\f0d6"}.fa-caret-down:before{content:"\f0d7"}.fa-caret-up:before{content:"\f0d8"}.fa-caret-left:before{content:"\f0d9"}.fa-caret-right:before{content:"\f0da"}.fa-columns:before{content:"\f0db"}.fa-sort:before,.fa-unsorted:before{content:"\f0dc"}.fa-sort-desc:before,.fa-sort-down:before{content:"\f0dd"}.fa-sort-asc:before,.fa-sort-up:before{content:"\f0de"}.fa-envelope:before{content:"\f0e0"}.fa-linkedin:before{content:"\f0e1"}.fa-rotate-left:before,.fa-undo:before{content:"\f0e2"}.fa-gavel:before,.fa-legal:before{content:"\f0e3"}.fa-dashboard:before,.fa-tachometer:before{content:"\f0e4"}.fa-comment-o:before{content:"\f0e5"}.fa-comments-o:before{content:"\f0e6"}.fa-bolt:before,.fa-flash:before{content:"\f0e7"}.fa-sitemap:before{content:"\f0e8"}.fa-umbrella:before{content:"\f0e9"}.fa-clipboard:before,.fa-paste:before{content:"\f0ea"}.fa-lightbulb-o:before{content:"\f0eb"}.fa-exchange:before{content:"\f0ec"}.fa-cloud-download:before{content:"\f0ed"}.fa-cloud-upload:before{content:"\f0ee"}.fa-user-md:before{content:"\f0f0"}.fa-stethoscope:before{content:"\f0f1"}.fa-suitcase:before{content:"\f0f2"}.fa-bell-o:before{content:"\f0a2"}.fa-coffee:before{content:"\f0f4"}.fa-cutlery:before{content:"\f0f5"}.fa-file-text-o:before{content:"\f0f6"}.fa-building-o:before{content:"\f0f7"}.fa-hospital-o:before{content:"\f0f8"}.fa-ambulance:before{content:"\f0f9"}.fa-medkit:before{content:"\f0fa"}.fa-fighter-jet:before{content:"\f0fb"}.fa-beer:before{content:"\f0fc"}.fa-h-square:before{content:"\f0fd"}.fa-plus-square:before{content:"\f0fe"}.fa-angle-double-left:before{content:"\f100"}.fa-angle-double-right:before{content:"\f101"}.fa-angle-double-up:before{content:"\f102"}.fa-angle-double-down:before{content:"\f103"}.fa-angle-left:before{content:"\f104"}.fa-angle-right:before{content:"\f105"}.fa-angle-up:before{content:"\f106"}.fa-angle-down:before{content:"\f107"}.fa-desktop:before{content:"\f108"}.fa-laptop:before{content:"\f109"}.fa-tablet:before{content:"\f10a"}.fa-mobile-phone:before,.fa-mobile:before{content:"\f10b"}.fa-circle-o:before{content:"\f10c"}.fa-quote-left:before{content:"\f10d"}.fa-quote-right:before{content:"\f10e"}.fa-spinner:before{content:"\f110"}.fa-circle:before{content:"\f111"}.fa-mail-reply:before,.fa-reply:before{content:"\f112"}.fa-github-alt:before{content:"\f113"}.fa-folder-o:before{content:"\f114"}.fa-folder-open-o:before{content:"\f115"}.fa-smile-o:before{content:"\f118"}.fa-frown-o:before{content:"\f119"}.fa-meh-o:before{content:"\f11a"}.fa-gamepad:before{content:"\f11b"}.fa-keyboard-o:before{content:"\f11c"}.fa-flag-o:before{content:"\f11d"}.fa-flag-checkered:before{content:"\f11e"}.fa-terminal:before{content:"\f120"}.fa-code:before{content:"\f121"}.fa-mail-reply-all:before,.fa-reply-all:before{content:"\f122"}.fa-star-half-empty:before,.fa-star-half-full:before,.fa-star-half-o:before{content:"\f123"}.fa-location-arrow:before{content:"\f124"}.fa-crop:before{content:"\f125"}.fa-code-fork:before{content:"\f126"}.fa-chain-broken:before,.fa-unlink:before{content:"\f127"}.fa-question:before{content:"\f128"}.fa-info:before{content:"\f129"}.fa-exclamation:before{content:"\f12a"}.fa-superscript:before{content:"\f12b"}.fa-subscript:before{content:"\f12c"}.fa-eraser:before{content:"\f12d"}.fa-puzzle-piece:before{content:"\f12e"}.fa-microphone:before{content:"\f130"}.fa-microphone-slash:before{content:"\f131"}.fa-shield:before{content:"\f132"}.fa-calendar-o:before{content:"\f133"}.fa-fire-extinguisher:before{content:"\f134"}.fa-rocket:before{content:"\f135"}.fa-maxcdn:before{content:"\f136"}.fa-chevron-circle-left:before{content:"\f137"}.fa-chevron-circle-right:before{content:"\f138"}.fa-chevron-circle-up:before{content:"\f139"}.fa-chevron-circle-down:before{content:"\f13a"}.fa-html5:before{content:"\f13b"}.fa-css3:before{content:"\f13c"}.fa-anchor:before{content:"\f13d"}.fa-unlock-alt:before{content:"\f13e"}.fa-bullseye:before{content:"\f140"}.fa-ellipsis-h:before{content:"\f141"}.fa-ellipsis-v:before{content:"\f142"}.fa-rss-square:before{content:"\f143"}.fa-play-circle:before{content:"\f144"}.fa-ticket:before{content:"\f145"}.fa-minus-square:before{content:"\f146"}.fa-minus-square-o:before{content:"\f147"}.fa-level-up:before{content:"\f148"}.fa-level-down:before{content:"\f149"}.fa-check-square:before{content:"\f14a"}.fa-pencil-square:before{content:"\f14b"}.fa-external-link-square:before{content:"\f14c"}.fa-share-square:before{content:"\f14d"}.fa-compass:before{content:"\f14e"}.fa-caret-square-o-down:before,.fa-toggle-down:before{content:"\f150"}.fa-caret-square-o-up:before,.fa-toggle-up:before{content:"\f151"}.fa-caret-square-o-right:before,.fa-toggle-right:before{content:"\f152"}.fa-eur:before,.fa-euro:before{content:"\f153"}.fa-gbp:before{content:"\f154"}.fa-dollar:before,.fa-usd:before{content:"\f155"}.fa-inr:before,.fa-rupee:before{content:"\f156"}.fa-cny:before,.fa-jpy:before,.fa-rmb:before,.fa-yen:before{content:"\f157"}.fa-rouble:before,.fa-rub:before,.fa-ruble:before{content:"\f158"}.fa-krw:before,.fa-won:before{content:"\f159"}.fa-bitcoin:before,.fa-btc:before{content:"\f15a"}.fa-file:before{content:"\f15b"}.fa-file-text:before{content:"\f15c"}.fa-sort-alpha-asc:before{content:"\f15d"}.fa-sort-alpha-desc:before{content:"\f15e"}.fa-sort-amount-asc:before{content:"\f160"}.fa-sort-amount-desc:before{content:"\f161"}.fa-sort-numeric-asc:before{content:"\f162"}.fa-sort-numeric-desc:before{content:"\f163"}.fa-thumbs-up:before{content:"\f164"}.fa-thumbs-down:before{content:"\f165"}.fa-youtube-square:before{content:"\f166"}.fa-youtube:before{content:"\f167"}.fa-xing:before{content:"\f168"}.fa-xing-square:before{content:"\f169"}.fa-youtube-play:before{content:"\f16a"}.fa-dropbox:before{content:"\f16b"}.fa-stack-overflow:before{content:"\f16c"}.fa-instagram:before{content:"\f16d"}.fa-flickr:before{content:"\f16e"}.fa-adn:before{content:"\f170"}.fa-bitbucket:before{content:"\f171"}.fa-bitbucket-square:before{content:"\f172"}.fa-tumblr:before{content:"\f173"}.fa-tumblr-square:before{content:"\f174"}.fa-long-arrow-down:before{content:"\f175"}.fa-long-arrow-up:before{content:"\f176"}.fa-long-arrow-left:before{content:"\f177"}.fa-long-arrow-right:before{content:"\f178"}.fa-apple:before{content:"\f179"}.fa-windows:before{content:"\f17a"}.fa-android:before{content:"\f17b"}.fa-linux:before{content:"\f17c"}.fa-dribbble:before{content:"\f17d"}.fa-skype:before{content:"\f17e"}.fa-foursquare:before{content:"\f180"}.fa-trello:before{content:"\f181"}.fa-female:before{content:"\f182"}.fa-male:before{content:"\f183"}.fa-gittip:before,.fa-gratipay:before{content:"\f184"}.fa-sun-o:before{content:"\f185"}.fa-moon-o:before{content:"\f186"}.fa-archive:before{content:"\f187"}.fa-bug:before{content:"\f188"}.fa-vk:before{content:"\f189"}.fa-weibo:before{content:"\f18a"}.fa-renren:before{content:"\f18b"}.fa-pagelines:before{content:"\f18c"}.fa-stack-exchange:before{content:"\f18d"}.fa-arrow-circle-o-right:before{content:"\f18e"}.fa-arrow-circle-o-left:before{content:"\f190"}.fa-caret-square-o-left:before,.fa-toggle-left:before{content:"\f191"}.fa-dot-circle-o:before{content:"\f192"}.fa-wheelchair:before{content:"\f193"}.fa-vimeo-square:before{content:"\f194"}.fa-try:before,.fa-turkish-lira:before{content:"\f195"}.fa-plus-square-o:before{content:"\f196"}.fa-space-shuttle:before{content:"\f197"}.fa-slack:before{content:"\f198"}.fa-envelope-square:before{content:"\f199"}.fa-wordpress:before{content:"\f19a"}.fa-openid:before{content:"\f19b"}.fa-bank:before,.fa-institution:before,.fa-university:before{content:"\f19c"}.fa-graduation-cap:before,.fa-mortar-board:before{content:"\f19d"}.fa-yahoo:before{content:"\f19e"}.fa-google:before{content:"\f1a0"}.fa-reddit:before{content:"\f1a1"}.fa-reddit-square:before{content:"\f1a2"}.fa-stumbleupon-circle:before{content:"\f1a3"}.fa-stumbleupon:before{content:"\f1a4"}.fa-delicious:before{content:"\f1a5"}.fa-digg:before{content:"\f1a6"}.fa-pied-piper-pp:before{content:"\f1a7"}.fa-pied-piper-alt:before{content:"\f1a8"}.fa-drupal:before{content:"\f1a9"}.fa-joomla:before{content:"\f1aa"}.fa-language:before{content:"\f1ab"}.fa-fax:before{content:"\f1ac"}.fa-building:before{content:"\f1ad"}.fa-child:before{content:"\f1ae"}.fa-paw:before{content:"\f1b0"}.fa-spoon:before{content:"\f1b1"}.fa-cube:before{content:"\f1b2"}.fa-cubes:before{content:"\f1b3"}.fa-behance:before{content:"\f1b4"}.fa-behance-square:before{content:"\f1b5"}.fa-steam:before{content:"\f1b6"}.fa-steam-square:before{content:"\f1b7"}.fa-recycle:before{content:"\f1b8"}.fa-automobile:before,.fa-car:before{content:"\f1b9"}.fa-cab:before,.fa-taxi:before{content:"\f1ba"}.fa-tree:before{content:"\f1bb"}.fa-spotify:before{content:"\f1bc"}.fa-deviantart:before{content:"\f1bd"}.fa-soundcloud:before{content:"\f1be"}.fa-database:before{content:"\f1c0"}.fa-file-pdf-o:before{content:"\f1c1"}.fa-file-word-o:before{content:"\f1c2"}.fa-file-excel-o:before{content:"\f1c3"}.fa-file-powerpoint-o:before{content:"\f1c4"}.fa-file-image-o:before,.fa-file-photo-o:before,.fa-file-picture-o:before{content:"\f1c5"}.fa-file-archive-o:before,.fa-file-zip-o:before{content:"\f1c6"}.fa-file-audio-o:before,.fa-file-sound-o:before{content:"\f1c7"}.fa-file-movie-o:before,.fa-file-video-o:before{content:"\f1c8"}.fa-file-code-o:before{content:"\f1c9"}.fa-vine:before{content:"\f1ca"}.fa-codepen:before{content:"\f1cb"}.fa-jsfiddle:before{content:"\f1cc"}.fa-life-bouy:before,.fa-life-buoy:before,.fa-life-ring:before,.fa-life-saver:before,.fa-support:before{content:"\f1cd"}.fa-circle-o-notch:before{content:"\f1ce"}.fa-ra:before,.fa-rebel:before,.fa-resistance:before{content:"\f1d0"}.fa-empire:before,.fa-ge:before{content:"\f1d1"}.fa-git-square:before{content:"\f1d2"}.fa-git:before{content:"\f1d3"}.fa-hacker-news:before,.fa-y-combinator-square:before,.fa-yc-square:before{content:"\f1d4"}.fa-tencent-weibo:before{content:"\f1d5"}.fa-qq:before{content:"\f1d6"}.fa-wechat:before,.fa-weixin:before{content:"\f1d7"}.fa-paper-plane:before,.fa-send:before{content:"\f1d8"}.fa-paper-plane-o:before,.fa-send-o:before{content:"\f1d9"}.fa-history:before{content:"\f1da"}.fa-circle-thin:before{content:"\f1db"}.fa-header:before{content:"\f1dc"}.fa-paragraph:before{content:"\f1dd"}.fa-sliders:before{content:"\f1de"}.fa-share-alt:before{content:"\f1e0"}.fa-share-alt-square:before{content:"\f1e1"}.fa-bomb:before{content:"\f1e2"}.fa-futbol-o:before,.fa-soccer-ball-o:before{content:"\f1e3"}.fa-tty:before{content:"\f1e4"}.fa-binoculars:before{content:"\f1e5"}.fa-plug:before{content:"\f1e6"}.fa-slideshare:before{content:"\f1e7"}.fa-twitch:before{content:"\f1e8"}.fa-yelp:before{content:"\f1e9"}.fa-newspaper-o:before{content:"\f1ea"}.fa-wifi:before{content:"\f1eb"}.fa-calculator:before{content:"\f1ec"}.fa-paypal:before{content:"\f1ed"}.fa-google-wallet:before{content:"\f1ee"}.fa-cc-visa:before{content:"\f1f0"}.fa-cc-mastercard:before{content:"\f1f1"}.fa-cc-discover:before{content:"\f1f2"}.fa-cc-amex:before{content:"\f1f3"}.fa-cc-paypal:before{content:"\f1f4"}.fa-cc-stripe:before{content:"\f1f5"}.fa-bell-slash:before{content:"\f1f6"}.fa-bell-slash-o:before{content:"\f1f7"}.fa-trash:before{content:"\f1f8"}.fa-copyright:before{content:"\f1f9"}.fa-at:before{content:"\f1fa"}.fa-eyedropper:before{content:"\f1fb"}.fa-paint-brush:before{content:"\f1fc"}.fa-birthday-cake:before{content:"\f1fd"}.fa-area-chart:before{content:"\f1fe"}.fa-pie-chart:before{content:"\f200"}.fa-line-chart:before{content:"\f201"}.fa-lastfm:before{content:"\f202"}.fa-lastfm-square:before{content:"\f203"}.fa-toggle-off:before{content:"\f204"}.fa-toggle-on:before{content:"\f205"}.fa-bicycle:before{content:"\f206"}.fa-bus:before{content:"\f207"}.fa-ioxhost:before{content:"\f208"}.fa-angellist:before{content:"\f209"}.fa-cc:before{content:"\f20a"}.fa-ils:before,.fa-shekel:before,.fa-sheqel:before{content:"\f20b"}.fa-meanpath:before{content:"\f20c"}.fa-buysellads:before{content:"\f20d"}.fa-connectdevelop:before{content:"\f20e"}.fa-dashcube:before{content:"\f210"}.fa-forumbee:before{content:"\f211"}.fa-leanpub:before{content:"\f212"}.fa-sellsy:before{content:"\f213"}.fa-shirtsinbulk:before{content:"\f214"}.fa-simplybuilt:before{content:"\f215"}.fa-skyatlas:before{content:"\f216"}.fa-cart-plus:before{content:"\f217"}.fa-cart-arrow-down:before{content:"\f218"}.fa-diamond:before{content:"\f219"}.fa-ship:before{content:"\f21a"}.fa-user-secret:before{content:"\f21b"}.fa-motorcycle:before{content:"\f21c"}.fa-street-view:before{content:"\f21d"}.fa-heartbeat:before{content:"\f21e"}.fa-venus:before{content:"\f221"}.fa-mars:before{content:"\f222"}.fa-mercury:before{content:"\f223"}.fa-intersex:before,.fa-transgender:before{content:"\f224"}.fa-transgender-alt:before{content:"\f225"}.fa-venus-double:before{content:"\f226"}.fa-mars-double:before{content:"\f227"}.fa-venus-mars:before{content:"\f228"}.fa-mars-stroke:before{content:"\f229"}.fa-mars-stroke-v:before{content:"\f22a"}.fa-mars-stroke-h:before{content:"\f22b"}.fa-neuter:before{content:"\f22c"}.fa-genderless:before{content:"\f22d"}.fa-facebook-official:before{content:"\f230"}.fa-pinterest-p:before{content:"\f231"}.fa-whatsapp:before{content:"\f232"}.fa-server:before{content:"\f233"}.fa-user-plus:before{content:"\f234"}.fa-user-times:before{content:"\f235"}.fa-bed:before,.fa-hotel:before{content:"\f236"}.fa-viacoin:before{content:"\f237"}.fa-train:before{content:"\f238"}.fa-subway:before{content:"\f239"}.fa-medium:before{content:"\f23a"}.fa-y-combinator:before,.fa-yc:before{content:"\f23b"}.fa-optin-monster:before{content:"\f23c"}.fa-opencart:before{content:"\f23d"}.fa-expeditedssl:before{content:"\f23e"}.fa-battery-4:before,.fa-battery-full:before,.fa-battery:before{content:"\f240"}.fa-battery-3:before,.fa-battery-three-quarters:before{content:"\f241"}.fa-battery-2:before,.fa-battery-half:before{content:"\f242"}.fa-battery-1:before,.fa-battery-quarter:before{content:"\f243"}.fa-battery-0:before,.fa-battery-empty:before{content:"\f244"}.fa-mouse-pointer:before{content:"\f245"}.fa-i-cursor:before{content:"\f246"}.fa-object-group:before{content:"\f247"}.fa-object-ungroup:before{content:"\f248"}.fa-sticky-note:before{content:"\f249"}.fa-sticky-note-o:before{content:"\f24a"}.fa-cc-jcb:before{content:"\f24b"}.fa-cc-diners-club:before{content:"\f24c"}.fa-clone:before{content:"\f24d"}.fa-balance-scale:before{content:"\f24e"}.fa-hourglass-o:before{content:"\f250"}.fa-hourglass-1:before,.fa-hourglass-start:before{content:"\f251"}.fa-hourglass-2:before,.fa-hourglass-half:before{content:"\f252"}.fa-hourglass-3:before,.fa-hourglass-end:before{content:"\f253"}.fa-hourglass:before{content:"\f254"}.fa-hand-grab-o:before,.fa-hand-rock-o:before{content:"\f255"}.fa-hand-paper-o:before,.fa-hand-stop-o:before{content:"\f256"}.fa-hand-scissors-o:before{content:"\f257"}.fa-hand-lizard-o:before{content:"\f258"}.fa-hand-spock-o:before{content:"\f259"}.fa-hand-pointer-o:before{content:"\f25a"}.fa-hand-peace-o:before{content:"\f25b"}.fa-trademark:before{content:"\f25c"}.fa-registered:before{content:"\f25d"}.fa-creative-commons:before{content:"\f25e"}.fa-gg:before{content:"\f260"}.fa-gg-circle:before{content:"\f261"}.fa-tripadvisor:before{content:"\f262"}.fa-odnoklassniki:before{content:"\f263"}.fa-odnoklassniki-square:before{content:"\f264"}.fa-get-pocket:before{content:"\f265"}.fa-wikipedia-w:before{content:"\f266"}.fa-safari:before{content:"\f267"}.fa-chrome:before{content:"\f268"}.fa-firefox:before{content:"\f269"}.fa-opera:before{content:"\f26a"}.fa-internet-explorer:before{content:"\f26b"}.fa-television:before,.fa-tv:before{content:"\f26c"}.fa-contao:before{content:"\f26d"}.fa-500px:before{content:"\f26e"}.fa-amazon:before{content:"\f270"}.fa-calendar-plus-o:before{content:"\f271"}.fa-calendar-minus-o:before{content:"\f272"}.fa-calendar-times-o:before{content:"\f273"}.fa-calendar-check-o:before{content:"\f274"}.fa-industry:before{content:"\f275"}.fa-map-pin:before{content:"\f276"}.fa-map-signs:before{content:"\f277"}.fa-map-o:before{content:"\f278"}.fa-map:before{content:"\f279"}.fa-commenting:before{content:"\f27a"}.fa-commenting-o:before{content:"\f27b"}.fa-houzz:before{content:"\f27c"}.fa-vimeo:before{content:"\f27d"}.fa-black-tie:before{content:"\f27e"}.fa-fonticons:before{content:"\f280"}.fa-reddit-alien:before{content:"\f281"}.fa-edge:before{content:"\f282"}.fa-credit-card-alt:before{content:"\f283"}.fa-codiepie:before{content:"\f284"}.fa-modx:before{content:"\f285"}.fa-fort-awesome:before{content:"\f286"}.fa-usb:before{content:"\f287"}.fa-product-hunt:before{content:"\f288"}.fa-mixcloud:before{content:"\f289"}.fa-scribd:before{content:"\f28a"}.fa-pause-circle:before{content:"\f28b"}.fa-pause-circle-o:before{content:"\f28c"}.fa-stop-circle:before{content:"\f28d"}.fa-stop-circle-o:before{content:"\f28e"}.fa-shopping-bag:before{content:"\f290"}.fa-shopping-basket:before{content:"\f291"}.fa-hashtag:before{content:"\f292"}.fa-bluetooth:before{content:"\f293"}.fa-bluetooth-b:before{content:"\f294"}.fa-percent:before{content:"\f295"}.fa-gitlab:before{content:"\f296"}.fa-wpbeginner:before{content:"\f297"}.fa-wpforms:before{content:"\f298"}.fa-envira:before{content:"\f299"}.fa-universal-access:before{content:"\f29a"}.fa-wheelchair-alt:before{content:"\f29b"}.fa-question-circle-o:before{content:"\f29c"}.fa-blind:before{content:"\f29d"}.fa-audio-description:before{content:"\f29e"}.fa-volume-control-phone:before{content:"\f2a0"}.fa-braille:before{content:"\f2a1"}.fa-assistive-listening-systems:before{content:"\f2a2"}.fa-american-sign-language-interpreting:before,.fa-asl-interpreting:before{content:"\f2a3"}.fa-deaf:before,.fa-deafness:before,.fa-hard-of-hearing:before{content:"\f2a4"}.fa-glide:before{content:"\f2a5"}.fa-glide-g:before{content:"\f2a6"}.fa-sign-language:before,.fa-signing:before{content:"\f2a7"}.fa-low-vision:before{content:"\f2a8"}.fa-viadeo:before{content:"\f2a9"}.fa-viadeo-square:before{content:"\f2aa"}.fa-snapchat:before{content:"\f2ab"}.fa-snapchat-ghost:before{content:"\f2ac"}.fa-snapchat-square:before{content:"\f2ad"}.fa-pied-piper:before{content:"\f2ae"}.fa-first-order:before{content:"\f2b0"}.fa-yoast:before{content:"\f2b1"}.fa-themeisle:before{content:"\f2b2"}.fa-google-plus-circle:before,.fa-google-plus-official:before{content:"\f2b3"}.fa-fa:before,.fa-font-awesome:before{content:"\f2b4"}.fa-handshake-o:before{content:"\f2b5"}.fa-envelope-open:before{content:"\f2b6"}.fa-envelope-open-o:before{content:"\f2b7"}.fa-linode:before{content:"\f2b8"}.fa-address-book:before{content:"\f2b9"}.fa-address-book-o:before{content:"\f2ba"}.fa-address-card:before,.fa-vcard:before{content:"\f2bb"}.fa-address-card-o:before,.fa-vcard-o:before{content:"\f2bc"}.fa-user-circle:before{content:"\f2bd"}.fa-user-circle-o:before{content:"\f2be"}.fa-user-o:before{content:"\f2c0"}.fa-id-badge:before{content:"\f2c1"}.fa-drivers-license:before,.fa-id-card:before{content:"\f2c2"}.fa-drivers-license-o:before,.fa-id-card-o:before{content:"\f2c3"}.fa-quora:before{content:"\f2c4"}.fa-free-code-camp:before{content:"\f2c5"}.fa-telegram:before{content:"\f2c6"}.fa-thermometer-4:before,.fa-thermometer-full:before,.fa-thermometer:before{content:"\f2c7"}.fa-thermometer-3:before,.fa-thermometer-three-quarters:before{content:"\f2c8"}.fa-thermometer-2:before,.fa-thermometer-half:before{content:"\f2c9"}.fa-thermometer-1:before,.fa-thermometer-quarter:before{content:"\f2ca"}.fa-thermometer-0:before,.fa-thermometer-empty:before{content:"\f2cb"}.fa-shower:before{content:"\f2cc"}.fa-bath:before,.fa-bathtub:before,.fa-s15:before{content:"\f2cd"}.fa-podcast:before{content:"\f2ce"}.fa-window-maximize:before{content:"\f2d0"}.fa-window-minimize:before{content:"\f2d1"}.fa-window-restore:before{content:"\f2d2"}.fa-times-rectangle:before,.fa-window-close:before{content:"\f2d3"}.fa-times-rectangle-o:before,.fa-window-close-o:before{content:"\f2d4"}.fa-bandcamp:before{content:"\f2d5"}.fa-grav:before{content:"\f2d6"}.fa-etsy:before{content:"\f2d7"}.fa-imdb:before{content:"\f2d8"}.fa-ravelry:before{content:"\f2d9"}.fa-eercast:before{content:"\f2da"}.fa-microchip:before{content:"\f2db"}.fa-snowflake-o:before{content:"\f2dc"}.fa-superpowers:before{content:"\f2dd"}.fa-wpexplorer:before{content:"\f2de"}.fa-meetup:before{content:"\f2e0"}.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);border:0}.sr-only-focusable:active,.sr-only-focusable:focus{position:static;width:auto;height:auto;margin:0;overflow:visible;clip:auto}.nuxt-progress{position:fixed;top:0;left:0;right:0;height:2px;width:0;opacity:1;transition:width .1s,opacity .4s;background-color:#3b8070;z-index:999999}.nuxt-progress.nuxt-progress-notransition{transition:none}.nuxt-progress-failed{background-color:red}.main-container{padding-top:2em;padding-bottom:2.2em;max-width:900px;margin:0 auto}.scroll-top{cursor:pointer;opacity:0;position:fixed;box-sizing:border-box;right:2em;bottom:45px;width:40px;height:40px;padding:5px;background-color:#42b983;border-radius:20px;transform:translate(80px);transition:all .3s ease;box-shadow:0 0 3px 0 rgba(0,0,0,.12),0 3px 3px 0 rgba(0,0,0,.24)}.arrow-icon{background-image:url(/images/top.png);width:30px;height:30px;display:block;background-size:contain}.scroll-top-show{opacity:1;transform:translate(0);z-index:999}.time-info[data-v-63cd7978]{font-size:14px;float:right;padding-top:5px}.date[data-v-63cd7978]{padding-top:4px;color:#989898;padding-right:20px}.tags[data-v-63cd7978]{font-size:13px}.tags li[data-v-63cd7978]{list-style:none;float:right;padding:0 .1rem .1rem}.tags li a[data-v-63cd7978]{display:block;cursor:pointer;padding:.3rem .6rem .4rem;margin:0;border-radius:10px;line-height:1;background-color:#f7f7f7;transition:all .4s}.tags .active[data-v-63cd7978]{background-color:#42b983;color:#fff}.copyright[data-v-63cd7978]{font-size:14px;padding:15px;margin-bottom:20px;border-radius:4px;color:#468847;background-color:#dff0d8;border:1px solid #d6e9c6}@media screen and (max-width:768px){.tagset li a[data-v-63cd7978]{padding:.1rem 1rem}.tagset li[data-v-63cd7978]{margin:.2rem}}.toc[data-v-63cd7978]{display:block;width:100%;top:0}.gitment-comments-init-btn,.gitment-editor-submit{background-color:#42b983}.gitment-comments-init-btn:disabled,.gitment-editor-submit:disabled{background-color:#ccc}.gitment-comments-init-btn:hover,.gitment-editor-submit:hover{background-color:#28a745}.directory-panel[data-v-30fcf313]{position:relative;z-index:0;margin-right:auto!important;margin-left:auto!important;text-align:right;opacity:0}.directory-panel.initial[data-v-30fcf313]{opacity:0}.directory-panel.pinned[data-v-30fcf313],.directory-panel.unpinned[data-v-30fcf313]{opacity:1}.directory-panel.headroom--top[data-v-30fcf313]{opacity:0}.directory-panel.headroom--not-top[data-v-30fcf313]{transition:opacity .5s ease-in-out;opacity:1}.panel-heading[data-v-30fcf313]{border-bottom:5px solid #eee;font-weight:700}.directory{position:fixed;z-index:0;top:100px;display:inline-block;border-left:5px solid #eee;text-align:left;margin-left:10px}.directory li,.directory ul{padding-left:0;margin-left:10px;list-style:square}#toc>ul{padding-left:5px;position:relative;list-style:none}.directory ul li:before{position:relative;top:0;display:inline-block}.directory ul li a{display:inline-table;margin-left:5px;white-space:nowrap}.directory ul li ul li a{white-space:nowrap;color:#34495e}.directory ul li ul li ul li a{color:rgba(52,73,94,.83922)}.directory a:hover{color:#42b983}.footer[data-v-0cceb702]{text-align:center;color:#7f8c8d;padding-top:2em;padding-bottom:1em;border-top:1px solid #e5e5e5;font-size:.9em}.footer a[data-v-0cceb702]{color:#42b983;font-weight:600}</style>
  </head>
  <body data-n-head="">
    <div data-server-rendered="true" id="__nuxt"><!----><div id="__layout"><div><div id="header"><a href="/" id="logo" class="nuxt-link-active"><img src="https://static.hdagb.cn/img/34bbbdb.png"> <span>Linsir's Blog</span></a> <ul id="nav"><li><form id="search-form" action="https://www.google.com/"><input type="hidden" name="site" value="Norway"> <input id="search-query" name="q" class="st-default-search-input"></form></li> <li><a href="/page/about" class="nav-link">About</a></li> <li><a href="/archives" class="nav-link">Archives</a></li> <li><a href="/tags" class="nav-link">Tags</a></li> <li><a href="/links" class="nav-link">Links</a></li> <li class="nav-dropdown-container"><a class="nav-link">Pages</a><span class="arrow"></span> <ul class="nav-dropdown"><li><a href="https://github.com/linsir" target="_blank" class="nav-link">GitHub</a></li> <li><a href="https://twitter.com/vuejs" target="_blank" class="nav-link">Twitter</a></li></ul></li></ul></div> <div id="main"><div><div id="mobile-bar"><a class="menu-button"></a> <a href="/" class="logo"></a> <a href="/" class="title">Linsir's Blog</a></div> <div class="sidebar"><ul class="main-menu"><li><form id="search-form"><input id="search-query" class="st-default-search-input"></form></li> <li><a href="/page/about" class="nav-link">About</a></li> <li><a href="/archives" class="nav-link">Archives</a></li> <li><a href="/tags" class="nav-link">Tags</a></li> <li><a href="/links" class="nav-link">Links</a></li> <li class="nav-dropdown-container"><a class="nav-link">Pages</a><span class="arrow"></span> <ul class="nav-dropdown"><li><a href="https://github.com/linsir" target="_blank" class="nav-link">GitHub</a></li> <li><a href="https://twitter.com/vuejs" target="_blank" class="nav-link">Twitter</a></li></ul></li></ul></div></div> <div class="main-container"><section class="container" data-v-63cd7978><link href="//cdn.bootcss.com/highlight.js/9.9.0/styles/monokai-sublime.min.css" rel="stylesheet" data-v-63cd7978> <h1 data-v-63cd7978>CentOS7下Strongswan架设IPSec-IKEv1, IKEv2, L2TP VPN,适用于 IOS9,OSX, Windows, Linux</h1> <div class="post-info" data-v-63cd7978><div class="tags" data-v-63cd7978><ul data-v-63cd7978><li data-v-63cd7978><a href="/tags/30" class="active" data-v-63cd7978>VPN</a></li><li data-v-63cd7978><a href="/tags/34" class="active" data-v-63cd7978>DevOps</a></li><li data-v-63cd7978><a href="/tags/11" class="active" data-v-63cd7978>Linux</a></li></ul></div> <div class="time-info" data-v-63cd7978>
      发表于 <span class="date" data-v-63cd7978>2015-09-24 15:35:43</span>
      最后修改于 <span class="date" data-v-63cd7978>2015-09-24 15:35:43</span></div></div> <div class="clear" data-v-63cd7978></div> <div id="#marked-content" class="content" data-v-63cd7978><p></p>
<p>VPN 隧道协议PPTP、L2TP、IPSec和SSLVPN（SSTP，OpenVPN）中安全性逐级提高，相应的受到墙的干扰相对要弱点，但是现在我们考虑到跨平台，PPTP穿透力及安全性可以忽略，所以这里搭建支持 ikev1/ikev2 的 Ipsec VPN，适用于iOS、Android、Windows 7+ 、MacOS X,及Linux。为了兼容Windows 7以下的系统，同时搭建L2TP/IPSec支持。</p>
<h3 id="最后更新时间20160408-支持ios9-ikev2"><a class="markdownIt-Anchor" href="#最后更新时间20160408-支持ios9-ikev2">#</a> 最后更新时间：2016..04.08 支持IOS9 IKEV2</h3>
<h3 id="温馨提示这种方法不适合架梯子gfw干扰太强"><a class="markdownIt-Anchor" href="#温馨提示这种方法不适合架梯子gfw干扰太强">#</a> 温馨提示：这种方法不适合架梯子，GFW干扰太强。</h3>
<p>同时GFW对https及Shadowsocks也是能检测到，VPS间歇性的Timeout.</p>
<h2 id="安装-strongswan"><a class="markdownIt-Anchor" href="#安装-strongswan">#</a> 安装 StrongSwan</h2>
<p>由于Openswan已经没人维护了，所以我们选择更强大的Strongswan.它是一个完整的2.4和2.6的Linux内核下的IPsec和IKEv1 的实现。它也完全支持新的IKEv2协议的Linux 2.6内核。</p>
<p>StrongSwan 的发行版已包含在 EPEL 源中, 但是CentOS源的包比较旧，所以我们手动在官网<a href="https://www.strongswan.org/download.html">https://www.strongswan.org/download.html</a>下载安装包，当然你也可以直接源码编译。</p>
<pre><code class="shell">wget http://dl.fedoraproject.org/pub/epel/7/x86_64/s/strongswan-5.3.2-1.el7.x86_64.rpm
rpm -ihv strongswan-5.3.2-1.el7.x86_64.rpm
</code></pre>
<p>安装依赖：</p>
<pre><code class="shell"><span class="hljs-meta">#</span><span class="bash">CentOS</span>
yum install -y gmp-devel
<span class="hljs-meta">#</span><span class="bash">debian/ubuntu</span>
apt-get -y install gcc
apt-get -y install make
apt-get -y install install libgmp10 libgmp3-dev libssl-dev pkg-config libpcsclite-dev libpam0g-dev
</code></pre>
<p>编译：</p>
<pre><code class="shell">wget http://download.strongswan.org/strongswan.tar.gz
tar xzf strongswan.tar.gz
cd strongswan-*
./configure  --sysconfdir=/etc  --enable-openssl --enable-nat-transport --disable-mysql --disable-ldap  --disable-static --enable-shared --enable-md4 --enable-eap-mschapv2 --enable-eap-aka --enable-eap-aka-3gpp2  --enable-eap-gtc --enable-eap-identity --enable-eap-md5 --enable-eap-peap --enable-eap-radius --enable-eap-sim --enable-eap-sim-file --enable-eap-simaka-pseudonym --enable-eap-simaka-reauth --enable-eap-simaka-sql --enable-eap-tls --enable-eap-tnc --enable-eap-ttls
make && make install

</code></pre>
<p>这里需要注意下，官方教程编译configure时没有带这么多参数，我实测如果不带参数，安装成功后，在生成证书的时候，ipsec pki --gen 命令将不会成功，也不会提示任何错误。</p>
<h2 id="配置相关证书"><a class="markdownIt-Anchor" href="#配置相关证书">#</a> 配置相关证书</h2>
<p>每一个完整的 ssl 证书都有一个公钥和一个私钥。公钥是在网络上传输的，而私钥是藏好用来和接收到的公钥配对的（因此私钥里也有整个公钥，用来配对）。</p>
<ol>
<li>
<p>生成CA证书的私钥，并使用私钥，签名CA证书</p>
<pre><code class="shell">ipsec pki --gen --outform pem > ca.key.pem
ipsec pki --self --in ca.key.pem --dn "C=CN, O=VPN, CN=StrongSwan CA" --ca --lifetime 3650 --outform pem >ca.cert.pem
</code></pre>
<p>这里C 表示国家名，同样还有 ST 州/省名，L 地区名，STREET（全大写） 街道名。O 表示组织名。CN 为通用名</p>
</li>
<li>
<p>生成服务器证书所需的私钥,并用CA证书签发服务器证书</p>
<pre><code class="shell">ipsec pki --gen --outform pem > server.key.pem  
ipsec pki --pub --in server.key.pem | ipsec pki --issue --lifetime 1200 --cacert ca.cert.pem \\
    --cakey ca.key.pem --dn "C=CN, O=VPN, CN=vpn.linsir.org" \\
    --san="1.2.3.4" --san="vpn.linsir.org" --flag serverAuth --flag ikeIntermediate \\
    --outform pem > server.cert.pem
</code></pre>
<p>第二句是从我们刚生成的私钥里把公钥提取出来，然后用公钥去参与后面的服务器证书签发。</p>
<pre><code> - iOS 客户端要求 CN 也就是通用名必须是你的服务器的 URL 或 IP 地址;
 - Windows 7 不但要求了上面，还要求必须显式说明这个服务器证书的用途（用于与服务器进行认证），–flag serverAuth;
 - 非 iOS 的 Mac OS X 要求了“IP 安全网络密钥互换居间（IP Security IKE Intermediate）”这种增强型密钥用法（EKU），–flag ikdeIntermediate;
 - Android 和 iOS 都要求服务器别名（serverAltName）就是服务器的 URL 或 IP 地址，–san。
</code></pre>
<p><strong>所以这里C、O的值要跟第一步的一致，CN值及--san值是服务器公网地址或url,另外这里可以设置多个--san值。否则会出现错误 13801:IKE身份验证凭证不可接受.</strong></p>
</li>
</ol>
<s>
3. 生成客户端证书
<pre><code>```shell
ipsec pki --gen --outform pem > client.pem
 ipsec pki --pub --in client.pem | ipsec pki --issue --cacert ca.cert.pem \\
--cakey ca.pem --dn "C=CN, O=VPN, CN=VPN Client" \\
--outform pem > client.cert.pem
```
这里C、O的值要跟第一步的一致
</code></pre>
<ol start="4">
<li>
<p>生成 pkcs12 证书
pkcs12 证书用来导入手机或电脑的。</p>
<pre><code class="openssl">             -certfile ca<span class="hljs-selector-class">.cert</span><span class="hljs-selector-class">.pem</span> -caname <span class="hljs-string">"vpn.linsir.org"</span>  -out client<span class="hljs-selector-class">.cert</span><span class="hljs-selector-class">.p12</span>
</code></pre>
</li>
</ol>
</s>
<h2 id="安装证书"><a class="markdownIt-Anchor" href="#安装证书">#</a> 安装证书</h2>
<p>把证书复制到strongswan目录下。</p>
<pre><code class="shell">
cp -r ca.cert.pem /etc/strongswan/ipsec.d/cacerts/
cp -r server.cert.pem /etc/strongswan/ipsec.d/certs/
cp -r server.pem /etc/strongswan/ipsec.d/private/
</code></pre>
<h2 id="配置strongswan"><a class="markdownIt-Anchor" href="#配置strongswan">#</a> 配置StrongSwan</h2>
<h3 id="设备操作系统使用的-ike-版本"><a class="markdownIt-Anchor" href="#设备操作系统使用的-ike-版本">#</a> 设备/操作系统使用的 ike 版本</h3>
<ul>
<li>Linux: 命令行客户端就是 strongswan 本身，因此完美兼容，支持 ikev1/ikev2 和所有加密方法的连接。</li>
<li>Android: 只支持 ikev1(没有最新andriod手机，可能已经支持ikev2)。</li>
<li>iOS/Mac OS X: IPsec 客户端为自己修改的racoon。它只支持 ikev1，最新的IOS 9 Mac OS X 支持ikev2.</li>
<li>Windows: 只在 Windows 7 以后支持ikev2, Win XP需要用l2tp方式。</li>
</ul>
<h3 id="ipsecconf"><a class="markdownIt-Anchor" href="#ipsecconf">#</a> ipsec.conf</h3>
<p>vim /etc/strongswan/ipsec.conf</p>
<pre><code><span class="hljs-comment"># ipsec.conf - strongSwan IPsec configuration file</span>
<span class="hljs-comment"># basic configuration</span><span class="hljs-built_in">
config </span>setup
    <span class="hljs-attribute">uniqueids</span>=never              #允许多个客户端使用同一个证书,多设备同时在线

<span class="hljs-comment">#所有项目共用的配置项</span>
conn %default
    <span class="hljs-attribute">keyexchange</span>=ike              #ikev1 或 ikev2 都用这个
    <span class="hljs-attribute">left</span>=%any                    #服务器端标识,%any表示任意
    <span class="hljs-attribute">leftsubnet</span>=0.0.0.0/0         #服务器端虚拟ip, 0.0.0.0/0表示通配.
    <span class="hljs-attribute">right</span>=%any                   #客户端标识,%any表示任意

conn IKE-BASE
    <span class="hljs-attribute">ikelifetime</span>=60m
    <span class="hljs-attribute">keylife</span>=20m
    <span class="hljs-attribute">rekeymargin</span>=3m
    <span class="hljs-attribute">keyingtries</span>=1
    <span class="hljs-attribute">leftcert</span>=server.cert.pem     #服务器端证书
    <span class="hljs-attribute">rightsourceip</span>=10.0.0.0/24    #分配给客户端的虚拟<span class="hljs-built_in"> ip </span>段

<span class="hljs-comment"># for IOS9 and Win 7 or later</span>
conn ike2-eap
    <span class="hljs-attribute">also</span>=IKE-BASE
    <span class="hljs-attribute">keyexchange</span>=ikev2
    <span class="hljs-attribute">ike</span>=aes256-sha1-modp1024,aes128-sha1-modp1024,3des-sha1-modp1024!
    <span class="hljs-attribute">esp</span>=aes256-sha256,aes256-sha1,3des-sha1!
    <span class="hljs-attribute">leftsendcert</span>=always
    <span class="hljs-attribute">leftid</span>=vpn.linsir.org
    <span class="hljs-attribute">leftauth</span>=pubkey
    <span class="hljs-attribute">leftfirewall</span>=<span class="hljs-literal">yes</span>
    <span class="hljs-attribute">rightauth</span>=eap-mschapv2
    <span class="hljs-attribute">rightsendcert</span>=never
    <span class="hljs-attribute">eap_identity</span>=%any
    <span class="hljs-attribute">rekey</span>=<span class="hljs-literal">no</span>
    <span class="hljs-attribute">dpdaction</span>=clear
    <span class="hljs-attribute">fragmentation</span>=<span class="hljs-literal">yes</span>
    <span class="hljs-attribute">auto</span>=add

<span class="hljs-comment"># for IOS, use PSK key</span>
conn IPSec-IKEv1-PSK
    <span class="hljs-attribute">also</span>=IKE-BASE
    <span class="hljs-attribute">keyexchange</span>=ikev1
    <span class="hljs-attribute">fragmentation</span>=<span class="hljs-literal">yes</span>
    <span class="hljs-attribute">leftauth</span>=psk
    <span class="hljs-attribute">rightauth</span>=psk
    <span class="hljs-attribute">rightauth2</span>=xauth
    <span class="hljs-attribute">auto</span>=add

<span class="hljs-comment"># for andriod </span>
conn IPSec-xauth
    <span class="hljs-attribute">also</span>=IKE-BASE
    <span class="hljs-attribute">leftauth</span>=psk
    <span class="hljs-attribute">leftfirewall</span>=<span class="hljs-literal">yes</span>
    <span class="hljs-attribute">right</span>=%any
    <span class="hljs-attribute">rightauth</span>=psk
    <span class="hljs-attribute">rightauth2</span>=xauth
    <span class="hljs-attribute">auto</span>=add


<span class="hljs-comment"># for win xp l2tp,use psk</span>
conn L2TP-PSK
    <span class="hljs-attribute">keyexchange</span>=ikev1
    <span class="hljs-attribute">authby</span>=secret
    <span class="hljs-attribute">leftprotoport</span>=17/1701 #l2tp端口
    <span class="hljs-attribute">leftfirewall</span>=<span class="hljs-literal">no</span>
    <span class="hljs-attribute">rightprotoport</span>=17/%any
    <span class="hljs-attribute">type</span>=transport
    <span class="hljs-attribute">auto</span>=add
</code></pre>
<p>这里说明一下:</p>
<p><strong>ike:</strong> Win7 is aes256, sha-1, modp1024; iOS is aes256, sha-256, modp1024; OS X is 3DES, sha-1, modp1024</p>
<p><strong>esp:</strong> Win 7 is aes256-sha1, iOS is aes256-sha256, OS X is 3des-shal1
iOS支持的IKE为aes256-sha256-modp1024，OS X为3des-sha1-modp1024，Win7为aes256-sha1-modp1024。</p>
<p>注意ESP的顺序与IKE的一致。leftid@后跟着就是服务器证书的CN（Common Name）也是IOS9设置时的远程ID（Remote ID）.</p>
<p>具体配置说明可以参考<a href="https://zh.opensuse.org/SDB:Setup_Ipsec_VPN_with_Strongswan">https://zh.opensuse.org/SDB:Setup_Ipsec_VPN_with_Strongswan</a>及<a href="https://wiki.strongswan.org/projects/strongswan/wiki">官方文档</a></p>
<h3 id="strongswanconf"><a class="markdownIt-Anchor" href="#strongswanconf">#</a> strongswan.conf</h3>
<p>vim /etc/strongswan/strongswan.conf</p>
<pre><code><span class="hljs-comment"># strongswan.conf - strongSwan configuration file</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># Refer to the strongswan.conf(5) manpage for details</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># Configuration changes should be made in the included files</span>

<span class="hljs-section">charon</span> {
    <span class="hljs-attribute">load_modular</span> = <span class="hljs-literal">yes</span>
    duplicheck.enable = <span class="hljs-literal">no</span> <span class="hljs-comment">#是为了你能同时连接多个设备，所以要把冗余检查关闭</span>
    compress = <span class="hljs-literal">yes</span>
    plugins {
        <span class="hljs-attribute">include</span> strongswan.d/charon/<span class="hljs-regexp">*.conf</span>
    }
    dns1 = <span class="hljs-number">223.5.5.5</span>
    dns2 = <span class="hljs-number">8.8.8.8</span>
    <span class="hljs-comment"># for Windows WINS Server</span>
    nbns1 = <span class="hljs-number">223.5.5.5</span>
    nbns2 = <span class="hljs-number">8.8.8.8</span>
}

include strongswan.d/<span class="hljs-regexp">*.conf</span>
</code></pre>
<h3 id="密码认证文件"><a class="markdownIt-Anchor" href="#密码认证文件">#</a> 密码认证文件</h3>
<pre><code>
# /etc/ipsec.secrets - strongSwan IPsec secrets file
 
 
: <span class="hljs-type">RSA</span> server.pem
: <span class="hljs-type">PSK</span> <span class="hljs-string">"password"</span>
: <span class="hljs-type">XAUTH</span> <span class="hljs-string">"password"</span>
vpn %any : <span class="hljs-type">EAP</span> <span class="hljs-string">"password"</span>
wp设备名称\\user : <span class="hljs-type">EAP</span> <span class="hljs-string">"password"</span>  
# 仅对windowsphone8.<span class="hljs-number">1</span>设备,设备名称在`设置-关于-手机信息` 中查看

</code></pre>
<h2 id="启动strongswan"><a class="markdownIt-Anchor" href="#启动strongswan">#</a> 启动Strongswan</h2>
<pre><code class="shell">ipsec start 
<span class="hljs-meta">#</span><span class="bash"> 或者</span>
systemctl start strongswan.service

</code></pre>
<p>IKEv1,v2就搭建好了，我们配置L2TP/IPSec</p>
<h2 id="l2tpipsec"><a class="markdownIt-Anchor" href="#l2tpipsec">#</a> L2TP/IPSec</h2>
<h3 id="安装-xl2tpd"><a class="markdownIt-Anchor" href="#安装-xl2tpd">#</a> 安装 xl2tpd</h3>
<pre><code>yum install ppp xl2tpd
</code></pre>
<p>如果提示找不到安装包，我们还可以手动下载安装。</p>
<pre><code>wget http://dl.fedoraproject.org/pub/epel/7/x86_64/x/xl2tpd-1.3.6-8.el7.x86_64.rpm
rpm -ihv xl2tpd-1.3.6-8.el7.x86_64.rpm
</code></pre>
<h3 id="etcstrongswanipsecconf"><a class="markdownIt-Anchor" href="#etcstrongswanipsecconf">#</a> /etc/strongswan/ipsec.conf</h3>
<p>在/etc/strongswan/ipsec.conf最后添加</p>
<pre><code>conn L2TP-PSK
    <span class="hljs-attribute">keyexchange</span>=ikev1
    <span class="hljs-attribute">authby</span>=secret
    <span class="hljs-attribute">leftprotoport</span>=17/1701 #l2tp端口
    <span class="hljs-attribute">leftfirewall</span>=<span class="hljs-literal">no</span>
    <span class="hljs-attribute">rightprotoport</span>=17/%any
    <span class="hljs-attribute">type</span>=transport
    <span class="hljs-attribute">auto</span>=add
</code></pre>
<h3 id="xl2tpdconf"><a class="markdownIt-Anchor" href="#xl2tpdconf">#</a> xl2tpd.conf</h3>
<p>vim /etc/xl2tpd/xl2tpd.conf</p>
<pre><code>[global]<span class="hljs-built_in">
ipsec </span>saref = <span class="hljs-literal">no</span>
<span class="hljs-comment">#listen-addr = 1.2.3.4</span><span class="hljs-built_in">
port </span>=1701


[lns default]<span class="hljs-built_in">
ip </span>range = 10.0.1.2-10.0.1.254
local<span class="hljs-built_in"> ip </span>= 10.0.1.1
require chap = <span class="hljs-literal">yes</span>
refuse pap = <span class="hljs-literal">yes</span>
require authentication = <span class="hljs-literal">yes</span>
name = vpn<span class="hljs-built_in">
ppp </span><span class="hljs-builtin-name">debug</span> = <span class="hljs-literal">yes</span>
pppoptfile = /etc/ppp/options.xl2tpd
length bit = <span class="hljs-literal">yes</span>
</code></pre>
<p>这里注意下 ip range不要跟上面的strongswan冲突了，不然会部分上不了网。</p>
<h3 id="optionsxl2tpd"><a class="markdownIt-Anchor" href="#optionsxl2tpd">#</a> options.xl2tpd</h3>
<pre><code>vim /etc/ppp/options.xl2tpd 


    require-mschap-v2
    ms-dns <span class="hljs-number">223.5</span><span class="hljs-number">.5</span><span class="hljs-number">.5</span>
    ms-dns <span class="hljs-number">223.6</span><span class="hljs-number">.6</span><span class="hljs-number">.6</span>
    asyncmap <span class="hljs-number">0</span>
    auth
    crtscts
    lock
    hide-password
    modem
    debug
    name l2tpd
    proxyarp
    lcp-echo-<span class="hljs-built_in">int</span>erval <span class="hljs-number">30</span>
    lcp-echo-failure <span class="hljs-number">4</span>
    mtu <span class="hljs-number">1400</span>
    noccp
    connect-delay <span class="hljs-number">5000</span>
    debug
    logfile /var/log/xl2tpd.log
</code></pre>
<h3 id="设置用户名密码"><a class="markdownIt-Anchor" href="#设置用户名密码">#</a> 设置用户名,密码</h3>
<p>vim /etc/ppp/chap-secrets</p>
<pre><code># client    server  secret          IP addresses
vpn         *       admin           *
</code></pre>
<h3 id="启动xl2tpd"><a class="markdownIt-Anchor" href="#启动xl2tpd">#</a> 启动xl2tpd</h3>
<p>首先添加文件</p>
<p>vim /usr/lib/systemd/system/xl2tpd.service</p>
<pre><code><span class="hljs-section">[Unit]</span>
<span class="hljs-attr">Description</span>=Level <span class="hljs-number">2</span> Tunnel Protocol Daemon (L2TP)
<span class="hljs-attr">After</span>=syslog.target network.target
<span class="hljs-attr">After</span>=ipsec.service
<span class="hljs-comment"># Some ISPs in Russia use l2tp without IPsec, so don't insist anymore</span>
<span class="hljs-comment">#Wants=ipsec.service</span>
<span class="hljs-section">
[Service]</span>
<span class="hljs-attr">Type</span>=simple
<span class="hljs-attr">PIDFile</span>=/run/xl2tpd/xl2tpd.pid
<span class="hljs-attr">ExecStart</span>=/usr/bin/xl2tpd -D
<span class="hljs-attr">Restart</span>=<span class="hljs-literal">on</span>-abort
<span class="hljs-section">
[Install]</span>
<span class="hljs-attr">WantedBy</span>=multi-user.target
</code></pre>
<p>然后 执行：</p>
<pre><code>systemctl start xl2tpd
</code></pre>
<h2 id="配置转发及防火墙"><a class="markdownIt-Anchor" href="#配置转发及防火墙">#</a> 配置转发及防火墙</h2>
<p>为转发数据包，我们需要开启内核转发。</p>
<p>编辑/etc/sysctl.conf</p>
<pre><code>net<span class="hljs-selector-class">.ipv4</span><span class="hljs-selector-class">.ip_forward</span>=<span class="hljs-number">1</span>
net<span class="hljs-selector-class">.ipv6</span><span class="hljs-selector-class">.conf</span><span class="hljs-selector-class">.all</span><span class="hljs-selector-class">.forwarding</span>=<span class="hljs-number">1</span>
net<span class="hljs-selector-class">.ipv4</span><span class="hljs-selector-class">.conf</span><span class="hljs-selector-class">.all</span><span class="hljs-selector-class">.accept_redirects</span> = <span class="hljs-number">0</span>
net<span class="hljs-selector-class">.ipv4</span><span class="hljs-selector-class">.conf</span><span class="hljs-selector-class">.all</span><span class="hljs-selector-class">.send_redirects</span> = <span class="hljs-number">0</span>
</code></pre>
<p>然后sysctl -p使之生效。</p>
<h3 id="ipatables"><a class="markdownIt-Anchor" href="#ipatables">#</a> ipatables</h3>
<pre><code class="shell">iptables -A INPUT -p esp -j ACCEPT
iptables -A INPUT -p udp --dport 500 -j ACCEPT
iptables -A INPUT -p udp --dport 4500 -j ACCEPT
<span class="hljs-meta">#</span><span class="bash"> L2tp</span>
iptables -A INPUT -p udp -m udp --dport 1701 -j ACCEPT
<span class="hljs-meta">#</span><span class="bash"> 转发规则</span>
iptables -t nat -A POSTROUTING -s 10.0.0.0/24 -o enp7s0f0 -j MASQUERADE
</code></pre>
<p>注意 CentOS 网卡名称，我这里是<strong>enp7s0f0</strong>，而有的是<strong>eth0</strong>，具体根据实际情况来，另外有多网卡的，需要自己根据实际情况来设置iptables转发规则。</p>
<h2 id="开机启动"><a class="markdownIt-Anchor" href="#开机启动">#</a> 开机启动</h2>
<pre><code>systemctl enable xl2tpd
systemctl enable strongswan
</code></pre>
<h2 id="客户端配置及连接及测试"><a class="markdownIt-Anchor" href="#客户端配置及连接及测试">#</a> 客户端配置及连接及测试</h2>
<h3 id="win7"><a class="markdownIt-Anchor" href="#win7">#</a> win7</h3>
<p>导入证书</p>
<p>新建一个内容如下的bat批处理文件，然后把ca.cert.pem放在同一目录下，然后右键管理员运行。</p>
<pre><code class="bat">@<span class="hljs-built_in">echo</span> off
@<span class="hljs-built_in">setlocal</span> enableextensions
@<span class="hljs-built_in">set</span> current_dir="%~dp0"
@<span class="hljs-built_in">cd</span> /d "<span class="hljs-variable">%current_dir%</span>"
@<span class="hljs-built_in">echo</span> <span class="hljs-variable">%current_dir%</span>
@certutil -addstore root ca.cert.pem
<span class="hljs-keyword">if</span> <span class="hljs-variable">%ERRORLEVEL%</span> <span class="hljs-keyword">EQU</span> <span class="hljs-number">0</span> @<span class="hljs-built_in">echo</span> <span class="hljs-keyword">not</span> ok
<span class="hljs-built_in">pause</span>
</code></pre>
<p>然后新建vpn即可。</p>
<p><strong>注意：win8 win10 Ikev2有bug</strong>
tcp/ip协议不能设置属性，关闭远程网关，我的连接上之后，需要自己手动添加路由表。
<a href="http://www.xitonghe.com/jiaocheng/Windows10-3133.html">Win10系统VPN连接IPV4属性无法打开,需要关闭远程网关解决方法</a></p>
<p><a href="http://www.nicklitten.com/blog/how-fix-windows-10-problem-vpn-failed-initialize-connection-subsystem-cisco-anyconnect">http://www.nicklitten.com/blog/how-fix-windows-10-problem-vpn-failed-initialize-connection-subsystem-cisco-anyconnect</a></p>
<p>经测试，win8+使用证书登录的穿透性很差，而使用ca证书+EAP账号密码认证，连接速度很快，而且稳定。</p>
<h3 id="iosmac"><a class="markdownIt-Anchor" href="#iosmac">#</a> iOS/Mac</h3>
<p>把 CA 证书发邮件给自己，。在 iOS 上收邮件，导入两者注意是两个证书，一定要导入CA，或者后者不能使用，然后新建 IPSec VPN</p>
<p>在这里可以使用四种方式建立VPN：</p>
<ol>
<li>
<p>IPSec+EAP</p>
<ul>
<li>服务器是 IP 或都是 URL</li>
<li>账户和密码填 ipsec.secrets 里 EAP 前后的那两个</li>
<li>密钥输入 ipsec.secrets 里设置的 PSK 密码。</li>
</ul>
</li>
<li>
<p>IPSec+证书</p>
<ul>
<li>服务器是 IP 或都是 URL</li>
<li>账户和密码填 ipsec.secrets 里 EAP 前后的那两个（XAUTH的那个密码也行）</li>
<li>勾选使用证书并选择之</li>
</ul>
</li>
<li>
<p>L2TP</p>
<ul>
<li>服务器是 IP 或都是 URL</li>
<li>账户和密码填 etc/ppp/chap-secrets 里的</li>
<li>密钥输入 ipsec.secrets 里设置的 PSK 密码。</li>
</ul>
</li>
<li>
<p>IEKV2（IOS9）
首先是导入服务器ca.cert.pem证书，在设置－通用－描述文件中可以查看</p>
<ul>
<li>类型 IKEv2</li>
<li>服务器是 IP 或都是 URL</li>
<li>远程ID是 IP 或都是 URL</li>
<li>账户和密码填 ipsec.secrets 里 EAP 前后的那两个</li>
</ul>
</li>
</ol>
<h3 id="android"><a class="markdownIt-Anchor" href="#android">#</a> Android</h3>
<p>IPSec Xauth PSK</p>
<p>IPSec 预共享密钥：写 ipsec.secrets 里 PSK 后面的那个密码.</p>
<h2 id="调试"><a class="markdownIt-Anchor" href="#调试">#</a> 调试</h2>
<p>服务器端的日志就足够检测出绝大多数问题的来源。</p>
<pre><code class="shell">tail -f /var/log/strongswan-charon.log
or
tail -f /var/log/syslog #debian
tail -f /var/log/messages #centos
</code></pre>
<p>或者直接</p>
<pre><code>journalctl -f
</code></pre>
<p>粗暴观察。</p>
<p><strong>More:</strong> <a href="https://linsir.org/post/Strongswan-not-import-certs-and-some-tips">Strongswan IKEV2免导入证书配置及调试笔记</a></p>
<h2 id="扩展"><a class="markdownIt-Anchor" href="#扩展">#</a> 扩展</h2>
<ul>
<li>FreeRadius：账户认证和计费</li>
<li>daloRadius：用户账单管理</li>
</ul>
<h3 id="遇到的坑"><a class="markdownIt-Anchor" href="#遇到的坑">#</a> 遇到的坑：</h3>
<pre><code>Dec 16 15:41:53 debian charon: 09[NET] sending packet: from *.*.*.*[4500] to *.*.*.*[4500] (1180 bytes)
Dec 16 15:42:23 debian charon: 13[JOB] deleting half open IKE_SA after timeout
</code></pre>
<p>一直报这样子的错误，甚至我重新编译升级StrongSwan5.3.3到5.3.5，放狗搜索半天，<a href="https://ttz.im/2015/10/1335">https://ttz.im/2015/10/1335</a> 这个哥们成功了，可是我一样的配置还是不行，搞得我都装了个freeRadius来测试了。</p>
<p>最后才发现上次手机刷机之后，ca证书已经不存在了。导入，就成功！</p>
<p>关于freeRadius的可以参考这个链接：</p>
<p><a href="http://freeradius.akagi201.org/index.html">http://freeradius.akagi201.org/index.html</a></p>
<h2 id="参考链接"><a class="markdownIt-Anchor" href="#参考链接">#</a> 参考链接：</h2>
<ul>
<li><a href="https://zh.opensuse.org/SDB:Setup_Ipsec_VPN_with_Strongswan">https://zh.opensuse.org/SDB:Setup_Ipsec_VPN_with_Strongswan</a></li>
<li><a href="https://www.strongswan.org/documentation.html">https://www.strongswan.org/documentation.html</a></li>
<li><a href="http://blog.itnmg.net/centos7-ipsec-vpn/">http://blog.itnmg.net/centos7-ipsec-vpn/</a></li>
<li><a href="http://quericy.me/blog/512">http://quericy.me/blog/512</a></li>
<li><a href="https://oogami.name/1467/">https://oogami.name/1467/</a></li>
<li><a href="https://tyr.so/ipsec.html">https://tyr.so/ipsec.html</a></li>
<li><a href="https://ttz.im/2015/10/1335">https://ttz.im/2015/10/1335</a></li>
</ul>
</div> <p class="tip" style="display:none" data-v-63cd7978>提醒：本文最后更新于 <code data-v-63cd7978>1397</code>天前，文中所描述的信息可能已发生改变，请谨慎使用。</p> <div class="copyright" data-v-63cd7978><p data-v-63cd7978>版权属于：<a href="/" class="nuxt-link-active" data-v-63cd7978>Linsir's Blog</a></p> <p data-v-63cd7978>原文地址：<a href="/post/how_to_install_IPSec_IKEV2_base_on_strongswan_with_CentOS7" class="nuxt-link-exact-active nuxt-link-active" data-v-63cd7978>https://linsir.org/post/how_to_install_IPSec_IKEV2_base_on_strongswan_with_CentOS7</a></p> <p data-v-63cd7978>转载时必须以链接形式注明原始出处及本声明。</p></div> <p data-v-63cd7978>--EOF--</p> <hr data-v-63cd7978> <div id="comments" class="comments" data-v-63cd7978><div id="comments_thread" data-v-63cd7978>>看不到评论？GFW!!!</div></div> <div class="directory-panel headroom--not-bottom headroom--not-top unpinned" data-v-30fcf313 data-v-63cd7978><div class="directory" data-v-30fcf313><div class="panel-heading" style="margin-left:20px" data-v-30fcf313>目录</div> <div id="toc" data-v-30fcf313><ul class="toc">
<li>
<ul>
<li>
<ul>
<li><a href="#%E6%9C%80%E5%90%8E%E6%9B%B4%E6%96%B0%E6%97%B6%E9%97%B420160408-%E6%94%AF%E6%8C%81ios9-ikev2">最后更新时间：2016..04.08 支持IOS9 IKEV2</a></li>
<li><a href="#%E6%B8%A9%E9%A6%A8%E6%8F%90%E7%A4%BA%E8%BF%99%E7%A7%8D%E6%96%B9%E6%B3%95%E4%B8%8D%E9%80%82%E5%90%88%E6%9E%B6%E6%A2%AF%E5%AD%90gfw%E5%B9%B2%E6%89%B0%E5%A4%AA%E5%BC%BA">温馨提示：这种方法不适合架梯子，GFW干扰太强。</a></li>
</ul>
</li>
<li><a href="#%E5%AE%89%E8%A3%85-strongswan">安装 StrongSwan</a></li>
<li><a href="#%E9%85%8D%E7%BD%AE%E7%9B%B8%E5%85%B3%E8%AF%81%E4%B9%A6">配置相关证书</a></li>
<li><a href="#%E5%AE%89%E8%A3%85%E8%AF%81%E4%B9%A6">安装证书</a></li>
<li><a href="#%E9%85%8D%E7%BD%AEstrongswan">配置StrongSwan</a>
<ul>
<li><a href="#%E8%AE%BE%E5%A4%87%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E4%BD%BF%E7%94%A8%E7%9A%84-ike-%E7%89%88%E6%9C%AC">设备/操作系统使用的 ike 版本</a></li>
<li><a href="#ipsecconf">ipsec.conf</a></li>
<li><a href="#strongswanconf">strongswan.conf</a></li>
<li><a href="#%E5%AF%86%E7%A0%81%E8%AE%A4%E8%AF%81%E6%96%87%E4%BB%B6">密码认证文件</a></li>
</ul>
</li>
<li><a href="#%E5%90%AF%E5%8A%A8strongswan">启动Strongswan</a></li>
<li><a href="#l2tpipsec">L2TP/IPSec</a>
<ul>
<li><a href="#%E5%AE%89%E8%A3%85-xl2tpd">安装 xl2tpd</a></li>
<li><a href="#etcstrongswanipsecconf">/etc/strongswan/ipsec.conf</a></li>
<li><a href="#xl2tpdconf">xl2tpd.conf</a></li>
<li><a href="#optionsxl2tpd">options.xl2tpd</a></li>
<li><a href="#%E8%AE%BE%E7%BD%AE%E7%94%A8%E6%88%B7%E5%90%8D%E5%AF%86%E7%A0%81">设置用户名,密码</a></li>
<li><a href="#%E5%90%AF%E5%8A%A8xl2tpd">启动xl2tpd</a></li>
</ul>
</li>
<li><a href="#%E9%85%8D%E7%BD%AE%E8%BD%AC%E5%8F%91%E5%8F%8A%E9%98%B2%E7%81%AB%E5%A2%99">配置转发及防火墙</a>
<ul>
<li><a href="#ipatables">ipatables</a></li>
</ul>
</li>
<li><a href="#%E5%BC%80%E6%9C%BA%E5%90%AF%E5%8A%A8">开机启动</a></li>
<li><a href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E9%85%8D%E7%BD%AE%E5%8F%8A%E8%BF%9E%E6%8E%A5%E5%8F%8A%E6%B5%8B%E8%AF%95">客户端配置及连接及测试</a>
<ul>
<li><a href="#win7">win7</a></li>
<li><a href="#iosmac">iOS/Mac</a></li>
<li><a href="#android">Android</a></li>
</ul>
</li>
<li><a href="#%E8%B0%83%E8%AF%95">调试</a></li>
<li><a href="#%E6%89%A9%E5%B1%95">扩展</a>
<ul>
<li><a href="#%E9%81%87%E5%88%B0%E7%9A%84%E5%9D%91">遇到的坑：</a></li>
</ul>
</li>
<li><a href="#%E5%8F%82%E8%80%83%E9%93%BE%E6%8E%A5">参考链接：</a></li>
</ul>
</li>
</ul>
</div></div></div></section></div></div> <div class="footer" data-v-0cceb702>
    © Copyright 2014 - 2019 <br data-v-0cceb702>Powered by
    <a href="/" title="Linsir's Blog" data-v-0cceb702> Linsir</a> with
    <a href="https://openresty.org/" target="_blank" data-v-0cceb702>OpenResty</a>
    and <a href="https://github.com/vuejs/vue" target="_blank" data-v-0cceb702>Vue.js.</a>
    Theme modified from <a href="https://github.com/vuejs/cn.vuejs.org/tree/master/themes/vue" data-v-0cceb702>Vue</a></div> <div class="scroll-top" style="bottom:30px;right:30px"><i class="arrow-icon"></i></div></div></div></div><script>window.__NUXT__=function(n){return{layout:"default",data:[{post:{created_at:n,id:48,tags:[{name:"VPN",id:30},{name:"DevOps",id:34},{name:"Linux",id:11}],statuses:1,author_id:1,title:"CentOS7下Strongswan架设IPSec-IKEv1, IKEv2, L2TP VPN,适用于 IOS9,OSX, Windows, Linux",updated_at:n,url:"how_to_install_IPSec_IKEV2_base_on_strongswan_with_CentOS7",content:'\n@[TOC]\n\nVPN 隧道协议PPTP、L2TP、IPSec和SSLVPN（SSTP，OpenVPN）中安全性逐级提高，相应的受到墙的干扰相对要弱点，但是现在我们考虑到跨平台，PPTP穿透力及安全性可以忽略，所以这里搭建支持 ikev1/ikev2 的 Ipsec VPN，适用于iOS、Android、Windows 7+ 、MacOS X,及Linux。为了兼容Windows 7以下的系统，同时搭建L2TP/IPSec支持。\n\n### 最后更新时间：2016..04.08 支持IOS9 IKEV2\n### 温馨提示：这种方法不适合架梯子，GFW干扰太强。\n同时GFW对https及Shadowsocks也是能检测到，VPS间歇性的Timeout.\n\n\n## 安装 StrongSwan\n\n由于Openswan已经没人维护了，所以我们选择更强大的Strongswan.它是一个完整的2.4和2.6的Linux内核下的IPsec和IKEv1 的实现。它也完全支持新的IKEv2协议的Linux 2.6内核。\n\nStrongSwan 的发行版已包含在 EPEL 源中, 但是CentOS源的包比较旧，所以我们手动在官网<https://www.strongswan.org/download.html>下载安装包，当然你也可以直接源码编译。\n\n```shell\nwget http://dl.fedoraproject.org/pub/epel/7/x86_64/s/strongswan-5.3.2-1.el7.x86_64.rpm\nrpm -ihv strongswan-5.3.2-1.el7.x86_64.rpm\n```\n\n\n\n安装依赖：\n\n```shell\n#CentOS\nyum install -y gmp-devel\n#debian/ubuntu\napt-get -y install gcc\napt-get -y install make\napt-get -y install install libgmp10 libgmp3-dev libssl-dev pkg-config libpcsclite-dev libpam0g-dev\n```\n\n\n编译：\n\n```shell\nwget http://download.strongswan.org/strongswan.tar.gz\ntar xzf strongswan.tar.gz\ncd strongswan-*\n./configure  --sysconfdir=/etc  --enable-openssl --enable-nat-transport --disable-mysql --disable-ldap  --disable-static --enable-shared --enable-md4 --enable-eap-mschapv2 --enable-eap-aka --enable-eap-aka-3gpp2  --enable-eap-gtc --enable-eap-identity --enable-eap-md5 --enable-eap-peap --enable-eap-radius --enable-eap-sim --enable-eap-sim-file --enable-eap-simaka-pseudonym --enable-eap-simaka-reauth --enable-eap-simaka-sql --enable-eap-tls --enable-eap-tnc --enable-eap-ttls\nmake && make install\n\n```\n\n这里需要注意下，官方教程编译configure时没有带这么多参数，我实测如果不带参数，安装成功后，在生成证书的时候，ipsec pki --gen 命令将不会成功，也不会提示任何错误。\n\n\n\n\n## 配置相关证书\n每一个完整的 ssl 证书都有一个公钥和一个私钥。公钥是在网络上传输的，而私钥是藏好用来和接收到的公钥配对的（因此私钥里也有整个公钥，用来配对）。\n\n1. 生成CA证书的私钥，并使用私钥，签名CA证书\n\n    ```shell\n    ipsec pki --gen --outform pem > ca.key.pem\n    ipsec pki --self --in ca.key.pem --dn "C=CN, O=VPN, CN=StrongSwan CA" --ca --lifetime 3650 --outform pem >ca.cert.pem\n    ```\n    \n    这里C 表示国家名，同样还有 ST 州/省名，L 地区名，STREET（全大写） 街道名。O 表示组织名。CN 为通用名\n\n2. 生成服务器证书所需的私钥,并用CA证书签发服务器证书\n\n    ```shell\n    ipsec pki --gen --outform pem > server.key.pem  \n    ipsec pki --pub --in server.key.pem | ipsec pki --issue --lifetime 1200 --cacert ca.cert.pem \\\\\n        --cakey ca.key.pem --dn "C=CN, O=VPN, CN=vpn.linsir.org" \\\\\n        --san="1.2.3.4" --san="vpn.linsir.org" --flag serverAuth --flag ikeIntermediate \\\\\n        --outform pem > server.cert.pem\n    ```\n\n    第二句是从我们刚生成的私钥里把公钥提取出来，然后用公钥去参与后面的服务器证书签发。\n\n        - iOS 客户端要求 CN 也就是通用名必须是你的服务器的 URL 或 IP 地址;\n        - Windows 7 不但要求了上面，还要求必须显式说明这个服务器证书的用途（用于与服务器进行认证），–flag serverAuth;\n        - 非 iOS 的 Mac OS X 要求了“IP 安全网络密钥互换居间（IP Security IKE Intermediate）”这种增强型密钥用法（EKU），–flag ikdeIntermediate;\n        - Android 和 iOS 都要求服务器别名（serverAltName）就是服务器的 URL 或 IP 地址，–san。\n\n    **所以这里C、O的值要跟第一步的一致，CN值及--san值是服务器公网地址或url,另外这里可以设置多个--san值。否则会出现错误 13801:IKE身份验证凭证不可接受.**\n\n<s>\n3. 生成客户端证书\n\n    ```shell\n    ipsec pki --gen --outform pem > client.pem\n     ipsec pki --pub --in client.pem | ipsec pki --issue --cacert ca.cert.pem \\\\\n    --cakey ca.pem --dn "C=CN, O=VPN, CN=VPN Client" \\\\\n    --outform pem > client.cert.pem\n    ```\n    这里C、O的值要跟第一步的一致\n\n4. 生成 pkcs12 证书\n    pkcs12 证书用来导入手机或电脑的。\n\n    ```openssl pkcs12 -export -inkey client.pem -in client.cert.pem -name "VPN Client"\\\\\n                 -certfile ca.cert.pem -caname "vpn.linsir.org"  -out client.cert.p12\n    ```\n</s>\n\n## 安装证书\n把证书复制到strongswan目录下。\n\n```shell\n\ncp -r ca.cert.pem /etc/strongswan/ipsec.d/cacerts/\ncp -r server.cert.pem /etc/strongswan/ipsec.d/certs/\ncp -r server.pem /etc/strongswan/ipsec.d/private/\n```\n\n## 配置StrongSwan\n\n### 设备/操作系统使用的 ike 版本\n\n- Linux: 命令行客户端就是 strongswan 本身，因此完美兼容，支持 ikev1/ikev2 和所有加密方法的连接。\n- Android: 只支持 ikev1(没有最新andriod手机，可能已经支持ikev2)。\n- iOS/Mac OS X: IPsec 客户端为自己修改的racoon。它只支持 ikev1，最新的IOS 9 Mac OS X 支持ikev2.\n- Windows: 只在 Windows 7 以后支持ikev2, Win XP需要用l2tp方式。\n\n### ipsec.conf\nvim /etc/strongswan/ipsec.conf\n\n```\n# ipsec.conf - strongSwan IPsec configuration file\n# basic configuration\nconfig setup\n    uniqueids=never              #允许多个客户端使用同一个证书,多设备同时在线\n\n#所有项目共用的配置项\nconn %default\n    keyexchange=ike              #ikev1 或 ikev2 都用这个\n    left=%any                    #服务器端标识,%any表示任意\n    leftsubnet=0.0.0.0/0         #服务器端虚拟ip, 0.0.0.0/0表示通配.\n    right=%any                   #客户端标识,%any表示任意\n\nconn IKE-BASE\n    ikelifetime=60m\n    keylife=20m\n    rekeymargin=3m\n    keyingtries=1\n    leftcert=server.cert.pem     #服务器端证书\n    rightsourceip=10.0.0.0/24    #分配给客户端的虚拟 ip 段\n\n# for IOS9 and Win 7 or later\nconn ike2-eap\n    also=IKE-BASE\n    keyexchange=ikev2\n    ike=aes256-sha1-modp1024,aes128-sha1-modp1024,3des-sha1-modp1024!\n    esp=aes256-sha256,aes256-sha1,3des-sha1!\n    leftsendcert=always\n    leftid=vpn.linsir.org\n    leftauth=pubkey\n    leftfirewall=yes\n    rightauth=eap-mschapv2\n    rightsendcert=never\n    eap_identity=%any\n    rekey=no\n    dpdaction=clear\n    fragmentation=yes\n    auto=add\n\n# for IOS, use PSK key\nconn IPSec-IKEv1-PSK\n    also=IKE-BASE\n    keyexchange=ikev1\n    fragmentation=yes\n    leftauth=psk\n    rightauth=psk\n    rightauth2=xauth\n    auto=add\n\n# for andriod \nconn IPSec-xauth\n    also=IKE-BASE\n    leftauth=psk\n    leftfirewall=yes\n    right=%any\n    rightauth=psk\n    rightauth2=xauth\n    auto=add\n\n\n# for win xp l2tp,use psk\nconn L2TP-PSK\n    keyexchange=ikev1\n    authby=secret\n    leftprotoport=17/1701 #l2tp端口\n    leftfirewall=no\n    rightprotoport=17/%any\n    type=transport\n    auto=add\n```\n\n这里说明一下:\n\n**ike:** Win7 is aes256, sha-1, modp1024; iOS is aes256, sha-256, modp1024; OS X is 3DES, sha-1, modp1024\n\n**esp:** Win 7 is aes256-sha1, iOS is aes256-sha256, OS X is 3des-shal1\niOS支持的IKE为aes256-sha256-modp1024，OS X为3des-sha1-modp1024，Win7为aes256-sha1-modp1024。\n\n注意ESP的顺序与IKE的一致。leftid@后跟着就是服务器证书的CN（Common Name）也是IOS9设置时的远程ID（Remote ID）.\n\n具体配置说明可以参考<https://zh.opensuse.org/SDB:Setup_Ipsec_VPN_with_Strongswan>及[官方文档](https://wiki.strongswan.org/projects/strongswan/wiki)\n\n### strongswan.conf\nvim /etc/strongswan/strongswan.conf\n\n```\n# strongswan.conf - strongSwan configuration file\n#\n# Refer to the strongswan.conf(5) manpage for details\n#\n# Configuration changes should be made in the included files\n\ncharon {\n    load_modular = yes\n    duplicheck.enable = no #是为了你能同时连接多个设备，所以要把冗余检查关闭\n    compress = yes\n    plugins {\n        include strongswan.d/charon/*.conf\n    }\n    dns1 = 223.5.5.5\n    dns2 = 8.8.8.8\n    # for Windows WINS Server\n    nbns1 = 223.5.5.5\n    nbns2 = 8.8.8.8\n}\n\ninclude strongswan.d/*.conf\n```\n\n### 密码认证文件 \n\n```\n\n# /etc/ipsec.secrets - strongSwan IPsec secrets file\n \n \n: RSA server.pem\n: PSK "password"\n: XAUTH "password"\nvpn %any : EAP "password"\nwp设备名称\\\\user : EAP "password"  \n# 仅对windowsphone8.1设备,设备名称在`设置-关于-手机信息` 中查看\n\n```\n\n## 启动Strongswan\n```shell\nipsec start \n# 或者\nsystemctl start strongswan.service\n\n```\n\n\nIKEv1,v2就搭建好了，我们配置L2TP/IPSec\n\n## L2TP/IPSec\n\n### 安装 xl2tpd\n    \n    yum install ppp xl2tpd\n\n如果提示找不到安装包，我们还可以手动下载安装。\n\n    wget http://dl.fedoraproject.org/pub/epel/7/x86_64/x/xl2tpd-1.3.6-8.el7.x86_64.rpm\n    rpm -ihv xl2tpd-1.3.6-8.el7.x86_64.rpm\n\n### /etc/strongswan/ipsec.conf\n在/etc/strongswan/ipsec.conf最后添加\n\n```\nconn L2TP-PSK\n    keyexchange=ikev1\n    authby=secret\n    leftprotoport=17/1701 #l2tp端口\n    leftfirewall=no\n    rightprotoport=17/%any\n    type=transport\n    auto=add\n```\n\n### xl2tpd.conf\nvim /etc/xl2tpd/xl2tpd.conf\n\n```\n[global]\nipsec saref = no\n#listen-addr = 1.2.3.4\nport =1701\n\n\n[lns default]\nip range = 10.0.1.2-10.0.1.254\nlocal ip = 10.0.1.1\nrequire chap = yes\nrefuse pap = yes\nrequire authentication = yes\nname = vpn\nppp debug = yes\npppoptfile = /etc/ppp/options.xl2tpd\nlength bit = yes\n```\n\n这里注意下 ip range不要跟上面的strongswan冲突了，不然会部分上不了网。\n\n### options.xl2tpd\n```\nvim /etc/ppp/options.xl2tpd \n\n\n    require-mschap-v2\n    ms-dns 223.5.5.5\n    ms-dns 223.6.6.6\n    asyncmap 0\n    auth\n    crtscts\n    lock\n    hide-password\n    modem\n    debug\n    name l2tpd\n    proxyarp\n    lcp-echo-interval 30\n    lcp-echo-failure 4\n    mtu 1400\n    noccp\n    connect-delay 5000\n    debug\n    logfile /var/log/xl2tpd.log\n```\n\n\n### 设置用户名,密码\nvim /etc/ppp/chap-secrets\n\n    # client    server  secret          IP addresses\n    vpn         *       admin           *\n\n### 启动xl2tpd\n首先添加文件\n\nvim /usr/lib/systemd/system/xl2tpd.service\n\n```\n[Unit]\nDescription=Level 2 Tunnel Protocol Daemon (L2TP)\nAfter=syslog.target network.target\nAfter=ipsec.service\n# Some ISPs in Russia use l2tp without IPsec, so don\'t insist anymore\n#Wants=ipsec.service\n\n[Service]\nType=simple\nPIDFile=/run/xl2tpd/xl2tpd.pid\nExecStart=/usr/bin/xl2tpd -D\nRestart=on-abort\n\n[Install]\nWantedBy=multi-user.target\n```\n\n然后 执行：\n\n    systemctl start xl2tpd\n\n\n\n## 配置转发及防火墙\n为转发数据包，我们需要开启内核转发。\n\n编辑/etc/sysctl.conf\n\n```\nnet.ipv4.ip_forward=1\nnet.ipv6.conf.all.forwarding=1\nnet.ipv4.conf.all.accept_redirects = 0\nnet.ipv4.conf.all.send_redirects = 0\n```\n\n\n然后sysctl -p使之生效。\n\n### ipatables\n    \n```shell\niptables -A INPUT -p esp -j ACCEPT\niptables -A INPUT -p udp --dport 500 -j ACCEPT\niptables -A INPUT -p udp --dport 4500 -j ACCEPT\n# L2tp\niptables -A INPUT -p udp -m udp --dport 1701 -j ACCEPT\n# 转发规则\niptables -t nat -A POSTROUTING -s 10.0.0.0/24 -o enp7s0f0 -j MASQUERADE\n```\n\n注意 CentOS 网卡名称，我这里是**enp7s0f0**，而有的是**eth0**，具体根据实际情况来，另外有多网卡的，需要自己根据实际情况来设置iptables转发规则。\n\n\n## 开机启动\n\n    systemctl enable xl2tpd\n    systemctl enable strongswan\n\n\n## 客户端配置及连接及测试\n\n### win7\n导入证书\n\n新建一个内容如下的bat批处理文件，然后把ca.cert.pem放在同一目录下，然后右键管理员运行。\n\n```bat\n@echo off\n@setlocal enableextensions\n@set current_dir="%~dp0"\n@cd /d "%current_dir%"\n@echo %current_dir%\n@certutil -addstore root ca.cert.pem\nif %ERRORLEVEL% EQU 0 @echo not ok\npause\n```\n\n然后新建vpn即可。\n\n**注意：win8 win10 Ikev2有bug**\ntcp/ip协议不能设置属性，关闭远程网关，我的连接上之后，需要自己手动添加路由表。\n[Win10系统VPN连接IPV4属性无法打开,需要关闭远程网关解决方法](http://www.xitonghe.com/jiaocheng/Windows10-3133.html)\n\n<http://www.nicklitten.com/blog/how-fix-windows-10-problem-vpn-failed-initialize-connection-subsystem-cisco-anyconnect>\n\n经测试，win8+使用证书登录的穿透性很差，而使用ca证书+EAP账号密码认证，连接速度很快，而且稳定。\n\n### iOS/Mac\n把 CA 证书发邮件给自己，。在 iOS 上收邮件，导入两者注意是两个证书，一定要导入CA，或者后者不能使用，然后新建 IPSec VPN\n\n在这里可以使用四种方式建立VPN：\n\n1. IPSec+EAP\n    + 服务器是 IP 或都是 URL\n    + 账户和密码填 ipsec.secrets 里 EAP 前后的那两个\n    + 密钥输入 ipsec.secrets 里设置的 PSK 密码。\n\n2. IPSec+证书\n    + 服务器是 IP 或都是 URL\n    + 账户和密码填 ipsec.secrets 里 EAP 前后的那两个（XAUTH的那个密码也行）\n    + 勾选使用证书并选择之\n\n3. L2TP\n    + 服务器是 IP 或都是 URL\n    + 账户和密码填 etc/ppp/chap-secrets 里的\n    + 密钥输入 ipsec.secrets 里设置的 PSK 密码。\n\n4. IEKV2（IOS9）\n首先是导入服务器ca.cert.pem证书，在设置－通用－描述文件中可以查看\n\n    * 类型 IKEv2\n    * 服务器是 IP 或都是 URL\n    * 远程ID是 IP 或都是 URL\n    * 账户和密码填 ipsec.secrets 里 EAP 前后的那两个\n\n### Android\nIPSec Xauth PSK\n\nIPSec 预共享密钥：写 ipsec.secrets 里 PSK 后面的那个密码.\n\n## 调试\n\n服务器端的日志就足够检测出绝大多数问题的来源。\n\n```shell\ntail -f /var/log/strongswan-charon.log\nor\ntail -f /var/log/syslog #debian\ntail -f /var/log/messages #centos\n```\n\n或者直接\n\n    journalctl -f\n\n粗暴观察。\n\n**More:** [Strongswan IKEV2免导入证书配置及调试笔记](https://linsir.org/post/Strongswan-not-import-certs-and-some-tips)\n\n## 扩展\n\n- FreeRadius：账户认证和计费\n- daloRadius：用户账单管理\n\n### 遇到的坑：\n\n    Dec 16 15:41:53 debian charon: 09[NET] sending packet: from *.*.*.*[4500] to *.*.*.*[4500] (1180 bytes)\n    Dec 16 15:42:23 debian charon: 13[JOB] deleting half open IKE_SA after timeout\n\n一直报这样子的错误，甚至我重新编译升级StrongSwan5.3.3到5.3.5，放狗搜索半天，https://ttz.im/2015/10/1335 这个哥们成功了，可是我一样的配置还是不行，搞得我都装了个freeRadius来测试了。\n\n最后才发现上次手机刷机之后，ca证书已经不存在了。导入，就成功！\n\n关于freeRadius的可以参考这个链接：\n\nhttp://freeradius.akagi201.org/index.html\n\n## 参考链接：\n* <https://zh.opensuse.org/SDB:Setup_Ipsec_VPN_with_Strongswan>\n* <https://www.strongswan.org/documentation.html>\n* <http://blog.itnmg.net/centos7-ipsec-vpn/>\n* <http://quericy.me/blog/512>\n* <https://oogami.name/1467/>\n* <https://tyr.so/ipsec.html>\n* <https://ttz.im/2015/10/1335>'},show_days:!1}],error:null,state:{posts:[],tags:[],name:""},serverRendered:!0}}("2015-09-24 15:35:43")</script><script src="https://static.hdagb.cn/b99333d07f58a2457f11.js" defer></script><script src="https://static.hdagb.cn/ec75a6822724ae0b86fc.js" defer></script><script src="https://static.hdagb.cn/e0fea6d2c5ac316d33a0.js" defer></script><script src="https://static.hdagb.cn/1d9642f96a5761cf821e.js" defer></script>
  </body>
</html>
